<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA OR√áAMENTO PRO V5.1 - COMPLETO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.0.2/tesseract.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Lexend:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #00f2fe;
            --secondary: #ff2d75;
            --accent: #4f46e5;
            --dark-bg: #0b1120;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background-color: var(--dark-bg);
            color: #e2e8f0;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Tema Claro */
        body.theme-light {
            background-color: #f8fafc;
            color: #1e293b;
        }

        body.theme-light .futuristic-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #1e293b;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        body.theme-light .info-card {
            background: #ffffff;
            border: 1px solid rgba(0, 0, 0, 0.08);
            color: #334155;
        }

        body.theme-light .title-font.text-cyan-400 {
            color: #0e7490;
        }

        body.theme-light .text-slate-400 {
            color: #64748b !important;
        }

        body.theme-light .border-slate-800 {
            border-color: #e2e8f0 !important;
        }

        body.theme-light .bg-slate-900 {
            background-color: #f1f5f9 !important;
            color: #1e293b !important;
        }

        body.theme-light .bg-slate-800 {
            background-color: #e2e8f0 !important;
            color: #1e293b !important;
        }

        body.theme-light .bg-slate-800\/50 {
            background-color: rgba(226, 232, 240, 0.5) !important;
        }

        body.theme-light .neon-border:focus {
            border-color: #0e7490;
            box-shadow: 0 0 15px rgba(14, 116, 144, 0.3);
        }

        body.theme-light .tab-active {
            border-bottom-color: #0e7490;
            color: #0e7490;
        }

        body.theme-light .search-results {
            background: #ffffff;
            border-color: #e2e8f0;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        body.theme-light .search-item {
            border-bottom-color: #e2e8f0;
        }

        body.theme-light .search-item:hover {
            background: #f1f5f9;
            color: #0e7490;
        }

        body.theme-light .btn-gradient {
            background: linear-gradient(135deg, #0e7490, #0c4a6e);
        }

        body.theme-light .status-badge {
            color: #ffffff;
        }

        body.theme-light .status-pendente {
            background: #fef3c7;
            color: #92400e;
        }

        body.theme-light .status-aprovado {
            background: #d1fae5;
            color: #065f46;
        }

        body.theme-light .status-reprovado {
            background: #fee2e2;
            color: #991b1b;
        }

        body.theme-light .status-finalizado {
            background: #ede9fe;
            color: #5b21b6;
        }

        /* Scrollbar para tema claro */
        body.theme-light ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        body.theme-light ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #0e7490, #0c4a6e);
        }

        body.theme-light ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #0891b2, #0e7490);
        }

        /* Estilos base */
        .title-font {
            font-family: 'Orbitron', sans-serif;
        }

        .futuristic-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 242, 254, 0.15);
            border-radius: 1.5rem;
            transition: all 0.3s;
        }

        .neon-border:focus {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 242, 254, 0.3);
            outline: none;
        }

        .tab-active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: bold;
            background: rgba(0, 242, 254, 0.1);
        }

        .info-card {
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        /* Calculadora melhorada */
        #calc-container {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 320px;
            z-index: 200;
            background: #0f172a;
            border: 2px solid #00f2fe;
            border-radius: 1rem;
            padding: 15px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        body.theme-light #calc-container {
            background: #ffffff;
            border-color: #0e7490;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
        }

        .calc-btn {
            background: #1e293b;
            padding: 12px;
            border-radius: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
            font-weight: bold;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.theme-light .calc-btn {
            background: #f1f5f9;
            color: #1e293b;
            border-color: #e2e8f0;
        }

        .calc-btn:hover {
            background: #334155;
            color: #00f2fe;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 242, 254, 0.2);
        }

        body.theme-light .calc-btn:hover {
            background: #e2e8f0;
            color: #0e7490;
            box-shadow: 0 5px 15px rgba(14, 116, 144, 0.2);
        }

        .calc-btn:active {
            transform: translateY(0);
        }

        /* Template PDF */
        #pdf-template {
            width: 800px;
            padding: 50px;
            background: white;
            color: #1a202c;
            position: absolute;
            left: -9999px;
        }

        .pdf-table th {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 8px;
            font-size: 10px;
            color: #334155;
        }

        .pdf-table td {
            border: 1px solid #e2e8f0;
            padding: 8px;
            font-size: 11px;
            color: #000;
        }

        /* Resultados de busca */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 0.75rem;
            z-index: 50;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .search-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #334155;
            font-size: 13px;
            transition: all 0.2s;
        }

        .search-item:hover {
            background: #00f2fe22;
            color: #00f2fe;
            padding-left: 20px;
        }

        /* Logo animada 3D */
        .logo-container {
            position: relative;
            width: 140px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-3d {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            animation: float3d 6s ease-in-out infinite, rotateY 20s linear infinite;
            filter: drop-shadow(0 0 20px rgba(0, 242, 254, 0.5));
        }

        body.theme-light .logo-3d {
            filter: drop-shadow(0 0 20px rgba(14, 116, 144, 0.5));
        }

        .logo-inner {
            position: absolute;
            width: 80%;
            height: 80%;
            animation: pulse 3s ease-in-out infinite alternate;
            filter: drop-shadow(0 0 15px rgba(255, 45, 117, 0.5));
        }

        .logo-text {
            position: absolute;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 14px;
            color: #00f2fe;
            text-shadow: 0 0 10px #00f2fe;
            animation: glow 2s ease-in-out infinite alternate;
            z-index: 10;
        }

        body.theme-light .logo-text {
            color: #0e7490;
            text-shadow: 0 0 10px rgba(14, 116, 144, 0.5);
        }

        /* Part√≠culas para efeito 3D */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            animation: particle-float 3s infinite;
        }

        /* Anima√ß√µes */
        @keyframes float3d {

            0%,
            100% {
                transform: translateY(0px) rotateX(0deg) rotateY(0deg);
            }

            25% {
                transform: translateY(-10px) rotateX(5deg) rotateY(5deg);
            }

            50% {
                transform: translateY(0px) rotateX(0deg) rotateY(10deg);
            }

            75% {
                transform: translateY(-10px) rotateX(-5deg) rotateY(5deg);
            }
        }

        @keyframes particle-float {
            0% {
                transform: translateY(0) scale(1);
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                transform: translateY(-100px) scale(0);
                opacity: 0;
            }
        }

        @keyframes rotateY {
            from {
                transform: rotateY(0deg);
            }

            to {
                transform: rotateY(360deg);
            }
        }

        @keyframes pulse {
            from {
                transform: scale(1);
                opacity: 0.8;
            }

            to {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 5px #00f2fe, 0 0 10px #00f2fe;
            }

            to {
                text-shadow: 0 0 10px #00f2fe, 0 0 20px #00f2fe, 0 0 30px #ff2d75;
            }
        }

        body.theme-light @keyframes glow {
            from {
                text-shadow: 0 0 5px #0e7490, 0 0 10px #0e7490;
            }

            to {
                text-shadow: 0 0 10px #0e7490, 0 0 20px #0e7490, 0 0 30px #0891b2;
            }
        }

        /* Modal de importa√ß√£o */
        .import-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(11, 17, 32, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        body.theme-light .import-modal {
            background: rgba(248, 250, 252, 0.95);
        }

        .import-content {
            width: 90%;
            max-width: 900px;
            background: rgba(30, 41, 59, 0.95);
            border-radius: 1.5rem;
            border: 1px solid rgba(0, 242, 254, 0.3);
            padding: 2rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        body.theme-light .import-content {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(14, 116, 144, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
        }

        /* Status badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            text-transform: uppercase;
        }

        .status-pendente {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .status-aprovado {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-reprovado {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-finalizado {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        /* Modal de envio de email */
        .email-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(11, 17, 32, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        body.theme-light .email-modal {
            background: rgba(248, 250, 252, 0.95);
        }

        .email-content {
            width: 90%;
            max-width: 600px;
            background: rgba(30, 41, 59, 0.95);
            border-radius: 1.5rem;
            border: 1px solid rgba(0, 242, 254, 0.3);
            padding: 2rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        body.theme-light .email-content {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(14, 116, 144, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
        }

        /* Bot√µes com gradiente */
        .btn-gradient {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-weight: bold;
            border: none;
            transition: all 0.3s;
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 242, 254, 0.3);
            opacity: 0.9;
        }

        /* Anima√ß√µes de entrada */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary), var(--accent));
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--secondary), var(--primary));
        }

        /* Efeito de digita√ß√£o */
        .typing-effect {
            overflow: hidden;
            border-right: 3px solid var(--primary);
            white-space: nowrap;
            animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
        }

        @keyframes typing {
            from {
                width: 0
            }

            to {
                width: 100%
            }
        }

        @keyframes blink-caret {

            from,
            to {
                border-color: transparent
            }

            50% {
                border-color: var(--primary)
            }
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        body.theme-light .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-top: 3px solid #0e7490;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Estilos para centraliza√ß√£o das colunas QTD */
        .text-center {
            text-align: center !important;
        }

        input.qtd {
            text-align: center !important;
        }

        td.text-center,
        th.text-center {
            text-align: center !important;
            vertical-align: middle !important;
        }

        /* Estilo para estat√≠sticas de quantidade */
        .quantity-stats {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            border: 1px solid rgba(0, 242, 254, 0.2);
            border-radius: 0.75rem;
            padding: 0.75rem;
        }

        body.theme-light .quantity-stats {
            background: linear-gradient(145deg, #f1f5f9, #ffffff);
            border: 1px solid rgba(14, 116, 144, 0.2);
        }

        .quantity-badge {
            background: rgba(0, 242, 254, 0.1);
            border: 1px solid rgba(0, 242, 254, 0.3);
            border-radius: 0.5rem;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: bold;
            color: #00f2fe;
        }

        body.theme-light .quantity-badge {
            background: rgba(14, 116, 144, 0.1);
            border: 1px solid rgba(14, 116, 144, 0.3);
            color: #0e7490;
        }

        /* Bot√£o de tema */
        #theme-toggle {
            transition: all 0.3s;
            cursor: pointer;
        }

        #theme-toggle:hover {
            transform: scale(1.05);
        }

        .dark-mode-icon,
        .light-mode-icon {
            transition: opacity 0.3s;
        }
    </style>
</head>

<body class="p-4 md:p-8">

    <!-- Toast de sucesso -->
    <div id="success-toast"
        class="hidden fixed top-10 left-1/2 -translate-x-1/2 bg-emerald-500 text-white px-10 py-5 rounded-3xl font-bold shadow-2xl z-[101] animate-bounce text-center">
        <span id="toast-message">‚úÖ OPERA√á√ÉO CONCLU√çDA!</span>
    </div>

    <!-- Toast de erro -->
    <div id="error-toast"
        class="hidden fixed top-10 left-1/2 -translate-x-1/2 bg-red-500 text-white px-10 py-5 rounded-3xl font-bold shadow-2xl z-[101] animate-bounce text-center">
        <span id="error-message">‚ùå ERRO NA OPERA√á√ÉO!</span>
    </div>

    <!-- Modal de importa√ß√£o -->
    <div id="import-modal" class="import-modal hidden">
        <div class="import-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl title-font text-cyan-400">üìÑ IMPORTADOR INTELIGENTE DE PDF</h2>
                <button onclick="fecharImportModal()" class="text-slate-400 hover:text-white text-2xl">&times;</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="futuristic-card p-6">
                    <h3 class="title-font text-sm text-cyan-400 mb-4">üìä MODO AUTOM√ÅTICO (OCR)</h3>
                    <p class="text-xs text-slate-400 mb-4">Ideal para PDFs escaneados ou imagens. Usa intelig√™ncia
                        artificial para reconhecer texto.</p>
                    <input type="file" id="ocr-file" accept=".pdf,.png,.jpg,.jpeg" class="hidden">
                    <label for="ocr-file"
                        class="block w-full bg-gradient-to-r from-cyan-600 to-blue-600 py-3 rounded-xl text-center font-bold cursor-pointer hover:opacity-90 transition">
                        üì∏ ESCOLHER ARQUIVO (PDF/IMAGEM)
                    </label>
                    <div id="ocr-preview"
                        class="mt-4 p-4 bg-slate-900/50 rounded-lg text-xs font-mono max-h-60 overflow-y-auto hidden">
                    </div>
                </div>

                <div class="futuristic-card p-6">
                    <h3 class="title-font text-sm text-cyan-400 mb-4">‚öôÔ∏è MODO MANUAL</h3>
                    <p class="text-xs text-slate-400 mb-4">Para PDFs com texto selecion√°vel. Importa√ß√£o direta dos
                        dados.</p>
                    <input type="file" id="pdf-file" accept=".pdf" class="hidden">
                    <label for="pdf-file"
                        class="block w-full bg-gradient-to-r from-purple-600 to-pink-600 py-3 rounded-xl text-center font-bold cursor-pointer hover:opacity-90 transition">
                        üìÑ ESCOLHER PDF (TEXTO)
                    </label>
                    <div id="pdf-preview"
                        class="mt-4 p-4 bg-slate-900/50 rounded-lg text-xs font-mono max-h-60 overflow-y-auto hidden">
                    </div>
                </div>
            </div>

            <div class="futuristic-card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="title-font text-sm text-cyan-400">üîç PR√â-VISUALIZA√á√ÉO DOS ITENS</h3>
                    <div class="flex gap-2">
                        <button onclick="limparPreview()"
                            class="px-4 py-2 bg-slate-800 rounded-lg text-xs hover:bg-slate-700">Limpar</button>
                        <button onclick="importarParaOrcamento()"
                            class="px-4 py-2 bg-emerald-600 rounded-lg text-xs font-bold hover:bg-emerald-500">Importar
                            Todos</button>
                    </div>
                </div>
                <div id="itens-preview" class="overflow-x-auto">
                    <table class="w-full text-left text-xs">
                        <thead class="text-slate-500 border-b border-slate-800">
                            <tr>
                                <th class="pb-2 w-16 text-center">UN</th>
                                <th class="pb-2 w-16 text-center">QTD</th>
                                <th class="pb-2">DESCRI√á√ÉO</th>
                                <th class="pb-2 w-28 text-right">VALOR</th>
                                <th class="pb-2 w-20 text-center">A√á√ÉO</th>
                            </tr>
                        </thead>
                        <tbody id="itens-preview-body" class="divide-y divide-slate-800/50"></tbody>
                    </table>
                </div>
            </div>

            <div class="mt-6 flex justify-end gap-3">
                <button onclick="fecharImportModal()"
                    class="px-6 py-3 bg-slate-800 rounded-xl text-sm hover:bg-slate-700">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de envio de email -->
    <div id="email-modal" class="email-modal hidden">
        <div class="email-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl title-font text-cyan-400">üìß ENVIAR OR√áAMENTO POR EMAIL</h2>
                <button onclick="fecharEmailModal()" class="text-slate-400 hover:text-white text-2xl">&times;</button>
            </div>

            <div class="futuristic-card p-6 mb-6">
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-slate-400 mb-2 block">Para:</label>
                        <input type="email" id="email-to"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                            placeholder="email@cliente.com">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 mb-2 block">Assunto:</label>
                        <input type="text" id="email-subject"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                            placeholder="Or√ßamento [N√∫mero]">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 mb-2 block">Mensagem:</label>
                        <textarea id="email-message" rows="6"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                            placeholder="Prezado cliente...">Prezado(a) cliente,

Segue em anexo o or√ßamento solicitado conforme suas especifica√ß√µes.

Dados do Or√ßamento:
- N√∫mero: [NUMERO_ORCAMENTO]
- Data: [DATA_ORCAMENTO]
- Validade: [VALIDADE]
- Total: R$ [TOTAL]

Condi√ß√µes Comerciais:
- Forma de Pagamento: [FORMA_PAGAMENTO]
- Prazo de Entrega: [PRAZO_ENTREGA]
- Condi√ß√µes: [CONDICOES]

Ficamos √† disposi√ß√£o para quaisquer esclarecimentos adicionais.

Atenciosamente,
Equipe Comercial
[EMPRESA_NOME]</textarea>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="email-save-template" class="w-4 h-4">
                        <label for="email-save-template" class="text-xs text-slate-400">Salvar como template</label>
                    </div>
                </div>
            </div>

            <div class="flex justify-end gap-3">
                <button onclick="fecharEmailModal()"
                    class="px-6 py-3 bg-slate-800 rounded-xl text-sm hover:bg-slate-700">Cancelar</button>
                <button onclick="enviarEmailConfirmado()"
                    class="px-6 py-3 bg-cyan-600 rounded-xl text-sm hover:bg-cyan-500 font-bold">Enviar Email</button>
            </div>
        </div>
    </div>

    <!-- Modal de Configura√ß√µes Avan√ßadas -->
    <div id="config-modal" class="import-modal hidden">
        <div class="import-content" style="max-width: 1000px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl title-font text-cyan-400">‚öôÔ∏è CONFIGURA√á√ïES AVAN√áADAS</h2>
                <button onclick="fecharConfigModal()" class="text-slate-400 hover:text-white text-2xl">&times;</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Configura√ß√µes de Tabelas -->
                <div class="futuristic-card p-6">
                    <h3 class="title-font text-sm text-cyan-400 mb-4">üìä IDs DAS TABELAS BASEROW</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Tabela Empresas (817147)</label>
                            <input type="text" id="config-id-empresas"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                value="817147">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Tabela Clientes (817153)</label>
                            <input type="text" id="config-id-clientes"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                value="817153">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Tabela Itens (817162)</label>
                            <input type="text" id="config-id-itens"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                value="817162">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Tabela Or√ßamentos (817166)</label>
                            <input type="text" id="config-id-orcamentos"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                value="817166">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Tabela Configura√ß√µes (817171)</label>
                            <input type="text" id="config-id-configs"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                value="817171">
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes de Email -->
                <div class="futuristic-card p-6">
                    <h3 class="title-font text-sm text-cyan-400 mb-4">üìß CONFIGURA√á√ïES DE EMAIL</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">SMTP Host</label>
                                <input type="text" id="config-smtp-host"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                    placeholder="smtp.gmail.com">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">SMTP Port</label>
                                <input type="number" id="config-smtp-port"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                    placeholder="587" value="587">
                            </div>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">SMTP Username</label>
                            <input type="text" id="config-smtp-user"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                placeholder="seu@email.com">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">SMTP Password</label>
                            <input type="password" id="config-smtp-password"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                placeholder="Sua senha">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Email From</label>
                            <input type="email" id="config-email-from"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                placeholder="seu@email.com">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Email de Teste</label>
                            <input type="email" id="config-email-teste"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm"
                                placeholder="teste@email.com">
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes Gerais -->
                <div class="futuristic-card p-6 lg:col-span-2">
                    <h3 class="title-font text-sm text-cyan-400 mb-4">üîß CONFIGURA√á√ïES GERAIS DO SISTEMA</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Dias de Validade Padr√£o</label>
                            <input type="number" id="config-dias-validade"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm" value="10">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Formato N√∫mero Or√ßamento</label>
                            <select id="config-formato-num"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm">
                                <option value="ORC-{ANO}{MES}{DIA}-{NUM}">ORC-AAAAMMDD-NUM</option>
                                <option value="ORC-{ANO}-{NUM}">ORC-ANO-NUM</option>
                                <option value="ORC-{NUM}">ORC-NUM</option>
                                <option value="ORC{ANO}{NUM}">ORCAAANUM</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Status Inicial</label>
                            <select id="config-status-inicial"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm">
                                <option value="pendente">Pendente</option>
                                <option value="em_analise">Em An√°lise</option>
                                <option value="aguardando">Aguardando</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Notificar Status</label>
                            <select id="config-notificar-status"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm">
                                <option value="todos">Todos os Status</option>
                                <option value="aprovado">Somente Aprovado</option>
                                <option value="reprovado">Somente Reprovado</option>
                                <option value="nenhum">N√£o Notificar</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Tema do Sistema</label>
                            <select id="config-tema"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm">
                                <option value="dark">Dark (Padr√£o)</option>
                                <option value="light">Light</option>
                                <option value="blue">Blue</option>
                                <option value="purple">Purple</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Itens por P√°gina</label>
                            <input type="number" id="config-itens-pagina"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-700 text-sm" value="20"
                                min="5" max="100">
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center">
                <div>
                    <button onclick="testarConexaoBaserow()"
                        class="px-6 py-3 bg-blue-600 rounded-xl text-sm hover:bg-blue-500">
                        Testar Conex√£o Baserow
                    </button>
                    <button onclick="testarConfigEmail()"
                        class="px-6 py-3 bg-purple-600 rounded-xl text-sm hover:bg-purple-500 ml-3">
                        Testar Email
                    </button>
                </div>
                <div class="flex gap-3">
                    <button onclick="fecharConfigModal()"
                        class="px-6 py-3 bg-slate-800 rounded-xl text-sm hover:bg-slate-700">Cancelar</button>
                    <button onclick="salvarConfiguracoesAvancadas()"
                        class="px-6 py-3 bg-emerald-600 rounded-xl text-sm hover:bg-emerald-500 font-bold">Salvar
                        Configura√ß√µes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Widgets de informa√ß√µes -->
    <div class="max-w-7xl mx-auto grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="info-card p-4 rounded-2xl flex flex-col items-center">
            <span class="text-[10px] text-cyan-500 font-bold uppercase tracking-widest">Data</span>
            <p id="widget-date" class="text-lg font-bold">--/--/----</p>
        </div>
        <div class="info-card p-4 rounded-2xl flex flex-col items-center">
            <span class="text-[10px] text-cyan-500 font-bold uppercase tracking-widest">Hora</span>
            <p id="widget-time" class="text-lg font-bold tracking-widest">00:00:00</p>
        </div>
        <div class="info-card p-4 rounded-2xl flex flex-col items-center">
            <span class="text-[10px] text-cyan-500 font-bold uppercase tracking-widest">Itens</span>
            <p id="widget-quantidade" class="text-lg font-bold text-emerald-400">0</p>
        </div>
        <div class="info-card p-4 rounded-2xl flex flex-col items-center">
            <button id="theme-toggle"
                class="text-[10px] text-cyan-500 font-bold uppercase tracking-widest hover:text-cyan-400 transition">
                <span class="block mb-1">Tema</span>
                <div class="text-lg">
                    <i class="fas fa-moon dark-mode-icon"></i>
                    <i class="fas fa-sun light-mode-icon hidden"></i>
                </div>
            </button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto">
        <!-- Cabe√ßalho com logo animada 3D -->
        <header
            class="flex flex-col lg:flex-row justify-between items-center mb-8 border-b border-slate-800 pb-8 gap-6">
            <div class="flex items-center gap-4">
                <div class="logo-container">
                    <!-- Part√≠culas 3D -->
                    <div class="particle" style="top: 10%; left: 20%; animation-delay: 0s;"></div>
                    <div class="particle" style="top: 30%; left: 80%; animation-delay: 0.5s;"></div>
                    <div class="particle" style="top: 70%; left: 40%; animation-delay: 1s;"></div>
                    <div class="particle" style="top: 90%; left: 60%; animation-delay: 1.5s;"></div>

                    <svg class="logo-3d" viewBox="0 0 100 100">
                        <defs>
                            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#00f2fe;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#4f46e5;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#ff2d75;stop-opacity:1" />
                            </linearGradient>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="3" result="blur" />
                                <feMerge>
                                    <feMergeNode in="blur" />
                                    <feMergeNode in="SourceGraphic" />
                                </feMerge>
                            </filter>
                        </defs>
                        <circle cx="50" cy="50" r="45" fill="none" stroke="url(#logoGradient)" stroke-width="2"
                            stroke-dasharray="5,5" filter="url(#glow)" />
                        <circle cx="50" cy="50" r="35" fill="none" stroke="url(#logoGradient)" stroke-width="1.5"
                            stroke-dasharray="3,3" />
                        <polygon points="50,10 65,40 95,40 70,60 80,90 50,70 20,90 30,60 5,40 35,40" fill="none"
                            stroke="url(#logoGradient)" stroke-width="2" filter="url(#glow)" />
                    </svg>
                    <div class="logo-inner">
                        <svg viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="20" fill="rgba(0,242,254,0.2)" />
                        </svg>
                    </div>
                    <div class="logo-text">OR√á PRO</div>
                </div>
                <div>
                    <h1 class="text-2xl font-bold title-font text-cyan-400 tracking-tighter uppercase">OR√áAMENTO <span
                            class="text-white font-light">PRO</span></h1>
                    <span class="text-[9px] text-cyan-700 block font-bold tracking-[0.2em]">WEB INTERFACE V5.1
                        COMPLETA</span>
                    <div class="flex items-center gap-2 mt-1">
                        <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                        <span class="text-[8px] text-slate-500 font-bold" id="connection-status">Conectando...</span>
                    </div>
                </div>
            </div>
            <nav class="flex flex-wrap gap-2 p-1 bg-slate-900/80 rounded-2xl border border-slate-800 shadow-xl">
                <button onclick="switchTab('orcamento')" id="btn-orcamento"
                    class="px-4 py-2 rounded-xl transition text-sm tab-active">Or√ßamento</button>
                <button onclick="switchTab('clientes')" id="btn-clientes"
                    class="px-4 py-2 rounded-xl transition text-sm">Clientes</button>
                <button onclick="switchTab('empresas')" id="btn-empresas"
                    class="px-4 py-2 rounded-xl transition text-sm">Empresas</button>
                <button onclick="switchTab('itens')" id="btn-itens"
                    class="px-4 py-2 rounded-xl transition text-sm">Itens</button>
                <button onclick="switchTab('relatorios')" id="btn-relatorios"
                    class="px-4 py-2 rounded-xl transition text-sm">Hist√≥rico</button>
                <button onclick="abrirConfigModal()"
                    class="px-4 py-2 rounded-xl transition text-sm bg-gradient-to-r from-cyan-900 to-blue-900">
                    <i class="fas fa-cog mr-1"></i> Config
                </button>
            </nav>
        </header>

        <!-- Tab Or√ßamento -->
        <main id="tab-orcamento" class="fade-in">
            <div class="mb-8 relative">
                <label class="text-[10px] text-cyan-600 mb-2 block uppercase font-black">Pesquisar para Editar</label>
                <div class="flex gap-2">
                    <input type="text" id="search-orcamento" oninput="buscarOrcamento(this.value)"
                        placeholder="Nome do cliente, n√∫mero do or√ßamento..."
                        class="w-full bg-slate-900/80 p-4 rounded-xl border border-slate-700 neon-border text-sm">
                    <button onclick="limparTelaOrcamento()"
                        class="bg-slate-800 px-6 rounded-xl text-[10px] font-bold uppercase hover:bg-slate-700 transition">Limpar</button>
                    <button onclick="gerarPDF(false)"
                        class="bg-cyan-800 px-6 rounded-xl text-[10px] font-bold uppercase hover:bg-cyan-700 transition">Pr√©-visualizar</button>
                </div>
                <div id="search-results" class="search-results hidden"></div>
            </div>

            <!-- Estat√≠sticas de Quantidade -->
            <div class="futuristic-card p-4 mb-6">
                <div class="flex justify-between items-center">
                    <div class="quantity-stats">
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-box text-cyan-400"></i>
                                <span class="text-xs text-slate-400">Itens:</span>
                                <span class="quantity-badge" id="stats-quantidade-itens">0</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-calculator text-emerald-400"></i>
                                <span class="text-xs text-slate-400">Total Unid:</span>
                                <span class="quantity-badge" id="stats-quantidade-total">0</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-balance-scale text-amber-400"></i>
                                <span class="text-xs text-slate-400">M√©dia Qtd/Item:</span>
                                <span class="quantity-badge" id="stats-media-quantidade">0.00</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-xs text-slate-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        Estat√≠sticas atualizadas em tempo real
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Coluna Esquerda - Dados do Or√ßamento -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Dados da Empresa e Cliente -->
                    <div class="futuristic-card p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="text-[10px] text-slate-500 mb-1 block uppercase font-bold">Empresa
                                    Emissora</label>
                                <div class="relative">
                                    <select id="sel-empresa"
                                        class="w-full bg-slate-900/50 p-3 rounded-xl border border-slate-700 text-sm">
                                        <option value="">Selecione uma empresa</option>
                                    </select>
                                    <div class="absolute right-3 top-3 text-cyan-400">
                                        <i class="fas fa-building"></i>
                                    </div>
                                </div>
                                <div class="mt-2 text-xs text-slate-500" id="empresa-info"></div>
                            </div>
                            <div>
                                <label class="text-[10px] text-slate-500 mb-1 block uppercase font-bold">Cliente</label>
                                <div class="relative">
                                    <select id="sel-cliente" onchange="atualizarEmailCliente()"
                                        class="w-full bg-slate-900/50 p-3 rounded-xl border border-slate-700 text-sm">
                                        <option value="">Selecione um cliente</option>
                                    </select>
                                    <div class="absolute right-3 top-3 text-cyan-400">
                                        <i class="fas fa-user"></i>
                                    </div>
                                </div>
                                <div class="mt-2 text-xs text-slate-500" id="cliente-info"></div>
                            </div>
                        </div>

                        <!-- Datas e Validade -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div>
                                <label class="text-[10px] text-slate-500 mb-1 block uppercase font-bold">Data do
                                    Or√ßamento</label>
                                <input type="date" id="orcamento-data"
                                    class="w-full bg-slate-900/50 p-3 rounded-xl border border-slate-700 text-sm"
                                    value="">
                            </div>
                            <div>
                                <label class="text-[10px] text-slate-500 mb-1 block uppercase font-bold">Data de
                                    Validade</label>
                                <input type="date" id="orcamento-validade"
                                    class="w-full bg-slate-900/50 p-3 rounded-xl border border-slate-700 text-sm"
                                    value="">
                            </div>
                            <div>
                                <label class="text-[10px] text-slate-500 mb-1 block uppercase font-bold">N√∫mero do
                                    Or√ßamento</label>
                                <input type="text" id="orcamento-numero"
                                    class="w-full bg-slate-900/50 p-3 rounded-xl border border-slate-700 text-sm"
                                    placeholder="Auto-gerado" readonly>
                            </div>
                        </div>
                    </div>

                    <!-- Itens do Or√ßamento -->
                    <div class="futuristic-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="title-font text-xs tracking-widest text-slate-400 uppercase">
                                <i class="fas fa-list mr-2"></i>Itens da Proposta
                            </h3>
                            <div class="flex gap-2">
                                <button onclick="abrirImportModal()"
                                    class="text-[10px] bg-gradient-to-r from-cyan-600 to-blue-600 text-white font-bold px-4 py-2 rounded-full hover:opacity-90 transition flex items-center gap-2">
                                    <i class="fas fa-file-import"></i> IMPORTAR PDF
                                </button>
                                <button onclick="abrirModalItens()"
                                    class="text-[10px] bg-gradient-to-r from-emerald-600 to-green-600 text-white font-bold px-4 py-2 rounded-full hover:opacity-90 transition flex items-center gap-2">
                                    <i class="fas fa-boxes"></i> CAT√ÅLOGO
                                </button>
                                <button onclick="addItem()"
                                    class="text-[10px] bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold px-4 py-2 rounded-full hover:opacity-90 transition flex items-center gap-2">
                                    <i class="fas fa-plus"></i> NOVO ITEM
                                </button>
                            </div>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="text-slate-500 text-[10px] uppercase font-bold border-b border-slate-800">
                                    <tr>
                                        <th class="pb-4 w-16 text-center">UN</th>
                                        <th class="pb-4 w-20 text-center">QTD</th>
                                        <th class="pb-4">DESCRI√á√ÉO</th>
                                        <th class="pb-4 w-32 text-right">UNIT√ÅRIO</th>
                                        <th class="pb-4 w-32 text-right">TOTAL</th>
                                        <th class="pb-4 w-10"></th>
                                    </tr>
                                </thead>
                                <tbody id="lista-itens" class="divide-y divide-slate-800/50"></tbody>
                                <tfoot class="border-t border-slate-800">
                                    <tr>
                                        <td colspan="3" class="pt-4 text-right text-slate-500 text-sm font-bold">
                                            SUBTOTAL:</td>
                                        <td colspan="2" class="pt-4 text-right text-lg font-bold text-emerald-400"
                                            id="subtotal-geral">R$ 0,00</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="pt-2 text-right text-slate-500 text-sm font-bold">
                                            DESCONTO:</td>
                                        <td class="pt-2">
                                            <div class="flex items-center">
                                                <input type="number" id="desconto-percentual" min="0" max="100"
                                                    step="0.01"
                                                    class="w-20 bg-slate-900 border border-slate-700 rounded px-2 py-1 text-right text-sm"
                                                    value="0" onchange="calcularDesconto()" placeholder="%">
                                                <span class="ml-2 text-xs text-slate-500">%</span>
                                            </div>
                                        </td>
                                        <td class="pt-2 text-right text-red-400 font-bold" id="desconto-valor">R$ 0,00
                                        </td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" class="pt-2 text-right text-slate-500 text-sm font-bold">
                                            ACR√âSCIMO:</td>
                                        <td class="pt-2">
                                            <div class="flex items-center">
                                                <input type="number" id="acrescimo-percentual" min="0" max="100"
                                                    step="0.01"
                                                    class="w-20 bg-slate-900 border border-slate-700 rounded px-2 py-1 text-right text-sm"
                                                    value="0" onchange="calcularAcrescimo()" placeholder="%">
                                                <span class="ml-2 text-xs text-slate-500">%</span>
                                            </div>
                                        </td>
                                        <td class="pt-2 text-right text-blue-400 font-bold" id="acrescimo-valor">R$ 0,00
                                        </td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Coluna Direita - Condi√ß√µes e Total -->
                <div class="space-y-6">
                    <!-- Condi√ß√µes Comerciais -->
                    <div class="futuristic-card p-6">
                        <h3 class="title-font mb-4 text-cyan-500 text-[10px] tracking-widest">
                            <i class="fas fa-file-contract mr-2"></i>CONDI√á√ïES COMERCIAIS
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <label class="text-[10px] text-slate-500 uppercase font-bold ml-1">Forma de
                                    Pagamento</label>
                                <select id="cond-pagamento"
                                    class="w-full bg-slate-950 p-3 rounded-lg border border-slate-800 text-xs">
                                    <option>√Ä Vista - Dinheiro/PIX</option>
                                    <option>√Ä Vista - Cart√£o de Cr√©dito</option>
                                    <option>√Ä Vista - Cart√£o de D√©bito</option>
                                    <option>√Ä Vista - Transfer√™ncia</option>
                                    <option>30 Dias</option>
                                    <option>60 Dias</option>
                                    <option>90 Dias</option>
                                    <option>1+2 (30/60)</option>
                                    <option>1+1 (30/30)</option>
                                    <option>Personalizado</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] text-slate-500 uppercase font-bold ml-1">Prazo de
                                    Entrega</label>
                                <select id="cond-entrega"
                                    class="w-full bg-slate-950 p-3 rounded-lg border border-slate-800 text-xs">
                                    <option>Imediato</option>
                                    <option>3 dias √∫teis</option>
                                    <option>5 dias √∫teis</option>
                                    <option>10 dias √∫teis</option>
                                    <option>15 dias √∫teis</option>
                                    <option>30 dias √∫teis</option>
                                    <option>45 dias √∫teis</option>
                                    <option>60 dias √∫teis</option>
                                    <option>A Combinar</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] text-slate-500 uppercase font-bold ml-1">Condi√ß√µes
                                    Especiais</label>
                                <textarea id="cond-especiais" rows="3"
                                    class="w-full bg-slate-950 p-3 rounded-lg border border-slate-800 text-xs"
                                    placeholder="Informa√ß√µes adicionais..."></textarea>
                            </div>
                            <div>
                                <label class="text-[10px] text-slate-500 uppercase font-bold ml-1">Observa√ß√µes</label>
                                <textarea id="orcamento-observacoes" rows="3"
                                    class="w-full bg-slate-950 p-3 rounded-lg border border-slate-800 text-xs"
                                    placeholder="Observa√ß√µes internas..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo e A√ß√µes -->
                    <div class="futuristic-card p-6">
                        <div class="text-center mb-6">
                            <p class="text-[10px] text-slate-500 uppercase mb-1">Total Geral do Or√ßamento</p>
                            <p class="text-4xl font-bold text-emerald-400 mb-2" id="total-geral">R$ 0,00</p>
                            <div class="flex justify-center items-center gap-4 text-xs text-slate-500">
                                <div class="flex items-center">
                                    <div class="w-2 h-2 bg-emerald-500 rounded-full mr-1"></div>
                                    <span id="total-itens">0 itens</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-2 h-2 bg-cyan-500 rounded-full mr-1"></div>
                                    <span id="status-orcamento">Pendente</span>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <button onclick="salvarOrcamento()"
                                class="w-full bg-gradient-to-r from-emerald-600 to-green-600 py-4 rounded-xl font-bold hover:opacity-90 transition shadow-lg shadow-emerald-900/40 flex items-center justify-center gap-2">
                                <i class="fas fa-save"></i> SALVAR OR√áAMENTO
                            </button>
                            <button onclick="gerarPDF(true)"
                                class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 py-4 rounded-xl font-bold hover:opacity-90 transition shadow-lg shadow-cyan-900/40 flex items-center justify-center gap-2">
                                <i class="fas fa-file-pdf"></i> GERAR PDF
                            </button>
                            <button onclick="abrirEmailModal()" id="btn-enviar-email"
                                class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 py-4 rounded-xl font-bold hover:opacity-90 transition flex items-center justify-center gap-2"
                                disabled>
                                <i class="fas fa-paper-plane"></i> ENVIAR POR EMAIL
                            </button>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="duplicarOrcamento()"
                                    class="bg-slate-800 py-3 rounded-xl text-xs hover:bg-slate-700 transition">
                                    <i class="fas fa-copy mr-1"></i> Duplicar
                                </button>
                                <button onclick="limparTelaOrcamento()"
                                    class="bg-red-900/30 py-3 rounded-xl text-xs hover:bg-red-800/50 transition">
                                    <i class="fas fa-trash-alt mr-1"></i> Limpar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Tab Clientes -->
        <section id="tab-clientes" class="hidden fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Formul√°rio de Cliente -->
                <div class="futuristic-card p-6 h-fit">
                    <h2 class="text-lg title-font mb-6 text-cyan-400" id="cli-form-title">
                        <i class="fas fa-user-plus mr-2"></i>Novo Cadastro
                    </h2>
                    <input type="hidden" id="cli-id">
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Tipo</label>
                                <select id="cli-tipo"
                                    class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm">
                                    <option value="F√≠sica">Pessoa F√≠sica</option>
                                    <option value="Jur√≠dica">Pessoa Jur√≠dica</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">CPF/CNPJ</label>
                                <input type="text" id="cli-doc" oninput="maskDoc(this)"
                                    class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm"
                                    placeholder="000.000.000-00">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Nome/Raz√£o Social</label>
                            <input type="text" id="cli-nome"
                                class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 neon-border text-sm"
                                placeholder="Nome completo ou raz√£o social">
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Email</label>
                                <input type="email" id="cli-email"
                                    class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm"
                                    placeholder="cliente@email.com">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Telefone</label>
                                <input type="text" id="cli-telefone"
                                    class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm"
                                    placeholder="(11) 99999-9999">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Endere√ßo</label>
                            <input type="text" id="cli-endereco"
                                class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm"
                                placeholder="Rua, N√∫mero, Bairro">
                        </div>

                        <div class="grid grid-cols-3 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Cidade</label>
                                <input type="text" id="cli-cidade"
                                    class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm"
                                    placeholder="Cidade">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">UF</label>
                                <select id="cli-uf"
                                    class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm">
                                    <option value="">UF</option>
                                    <option value="AC">AC</option>
                                    <option value="AL">AL</option>
                                    <option value="AP">AP</option>
                                    <option value="AM">AM</option>
                                    <option value="BA">BA</option>
                                    <option value="CE">CE</option>
                                    <option value="DF">DF</option>
                                    <option value="ES">ES</option>
                                    <option value="GO">GO</option>
                                    <option value="MA">MA</option>
                                    <option value="MT">MT</option>
                                    <option value="MS">MS</option>
                                    <option value="MG">MG</option>
                                    <option value="PA">PA</option>
                                    <option value="PB">PB</option>
                                    <option value="PR">PR</option>
                                    <option value="PE">PE</option>
                                    <option value="PI">PI</option>
                                    <option value="RJ">RJ</option>
                                    <option value="RN">RN</option>
                                    <option value="RS">RS</option>
                                    <option value="RO">RO</option>
                                    <option value="RR">RR</option>
                                    <option value="SC">SC</option>
                                    <option value="SP">SP</option>
                                    <option value="SE">SE</option>
                                    <option value="TO">TO</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">CEP</label>
                                <input type="text" id="cli-cep"
                                    class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm"
                                    placeholder="00000-000">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Contato</label>
                                <input type="text" id="cli-contato"
                                    class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm"
                                    placeholder="Nome do contato">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Celular</label>
                                <input type="text" id="cli-celular"
                                    class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm"
                                    placeholder="(11) 99999-9999">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Observa√ß√µes</label>
                            <textarea id="cli-observacoes" rows="2"
                                class="w-full bg-slate-900 p-3 rounded-xl border border-slate-800 text-sm"
                                placeholder="Observa√ß√µes sobre o cliente..."></textarea>
                        </div>

                        <button onclick="salvarCliente()" id="btn-salvar-cli"
                            class="w-full bg-gradient-to-r from-emerald-600 to-green-600 py-4 rounded-xl font-bold hover:opacity-90 transition flex items-center justify-center gap-2">
                            <i class="fas fa-save"></i> SALVAR CLIENTE
                        </button>
                        <button onclick="limparCliForm()"
                            class="w-full bg-slate-800 py-3 rounded-xl text-xs hover:bg-slate-700 transition">
                            <i class="fas fa-times mr-1"></i> CANCELAR / NOVO
                        </button>
                    </div>
                </div>

                <!-- Lista de Clientes -->
                <div class="lg:col-span-2 futuristic-card p-6 overflow-x-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg title-font text-cyan-400">
                            <i class="fas fa-users mr-2"></i>Clientes Cadastrados
                        </h3>
                        <div class="flex gap-2">
                            <input type="text" id="search-cliente" oninput="filtrarClientes()"
                                placeholder="Buscar cliente..."
                                class="bg-slate-900 p-2 rounded-lg border border-slate-700 text-sm w-64">
                            <select id="filter-cliente-tipo" onchange="filtrarClientes()"
                                class="bg-slate-900 p-2 rounded-lg border border-slate-700 text-sm">
                                <option value="">Todos os tipos</option>
                                <option value="F√≠sica">Pessoa F√≠sica</option>
                                <option value="Jur√≠dica">Pessoa Jur√≠dica</option>
                            </select>
                        </div>
                    </div>
                    <table class="w-full">
                        <thead class="text-slate-500 border-b border-slate-800 text-[10px] uppercase">
                            <tr>
                                <th class="p-4 text-left">Nome/Contato</th>
                                <th class="p-4 text-left">Documento</th>
                                <th class="p-4 text-left">Contato</th>
                                <th class="p-4 text-right">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lista-clientes-body"></tbody>
                    </table>
                    <div id="clientes-pagination" class="mt-4 flex justify-center gap-2"></div>
                </div>
            </div>
        </section>

        <!-- Tab Empresas -->
        <section id="tab-empresas" class="hidden fade-in">
            <div class="futuristic-card p-6 mb-8">
                <h2 class="text-lg title-font mb-6 text-cyan-400" id="emp-form-title">
                    <i class="fas fa-building mr-2"></i>Empresa Emissora
                </h2>
                <input type="hidden" id="emp-id">

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">Nome Fantasia</label>
                        <input type="text" id="emp-nome"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                            placeholder="Nome da empresa">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">Raz√£o Social</label>
                        <input type="text" id="emp-razao-social"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                            placeholder="Raz√£o social completa">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">CNPJ</label>
                        <input type="text" id="emp-cnpj" oninput="maskCNPJ(this)"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                            placeholder="00.000.000/0000-00">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">Inscri√ß√£o Estadual</label>
                        <input type="text" id="emp-ie"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                            placeholder="000.000.000.000">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">Email</label>
                        <input type="email" id="emp-email"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                            placeholder="empresa@email.com">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">Telefone</label>
                        <input type="text" id="emp-telefone"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                            placeholder="(11) 3333-3333">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">Site</label>
                        <input type="text" id="emp-site"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                            placeholder="www.empresa.com.br">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">Endere√ßo</label>
                        <input type="text" id="emp-endereco"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                            placeholder="Rua, N√∫mero, Bairro">
                    </div>
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">Cidade</label>
                        <input type="text" id="emp-cidade"
                            class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                            placeholder="Cidade">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">UF</label>
                            <select id="emp-uf"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm">
                                <option value="">UF</option>
                                <option value="AC">AC</option>
                                <option value="AL">AL</option>
                                <option value="AP">AP</option>
                                <option value="AM">AM</option>
                                <option value="BA">BA</option>
                                <option value="CE">CE</option>
                                <option value="DF">DF</option>
                                <option value="ES">ES</option>
                                <option value="GO">GO</option>
                                <option value="MA">MA</option>
                                <option value="MT">MT</option>
                                <option value="MS">MS</option>
                                <option value="MG">MG</option>
                                <option value="PA">PA</option>
                                <option value="PB">PB</option>
                                <option value="PR">PR</option>
                                <option value="PE">PE</option>
                                <option value="PI">PI</option>
                                <option value="RJ">RJ</option>
                                <option value="RN">RN</option>
                                <option value="RS">RS</option>
                                <option value="RO">RO</option>
                                <option value="RR">RR</option>
                                <option value="SC">SC</option>
                                <option value="SP">SP</option>
                                <option value="SE">SE</option>
                                <option value="TO">TO</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">CEP</label>
                            <input type="text" id="emp-cep"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                placeholder="00000-000">
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="text-xs text-slate-400 mb-1 block">URL da Logo</label>
                        <div class="flex gap-2">
                            <input type="text" id="emp-logo"
                                class="flex-1 bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                placeholder="https://...">
                            <button onclick="visualizarLogo()" class="bg-cyan-800 px-4 rounded-lg hover:bg-cyan-700">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div id="logo-preview" class="mt-2 hidden">
                            <img id="logo-img" class="h-16 border border-slate-700 rounded">
                        </div>
                    </div>
                    <div class="flex items-end">
                        <button onclick="salvarEmpresa()" id="btn-salvar-emp"
                            class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 py-3 rounded-lg font-bold hover:opacity-90 transition">
                            <i class="fas fa-save mr-2"></i> SALVAR EMPRESA
                        </button>
                    </div>
                </div>
            </div>

            <div id="grid-empresas" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </section>

        <!-- Tab Itens/Cat√°logo -->
        <section id="tab-itens" class="hidden fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Formul√°rio de Item -->
                <div class="futuristic-card p-6 h-fit">
                    <h2 class="text-lg title-font mb-6 text-cyan-400" id="item-form-title">
                        <i class="fas fa-box mr-2"></i>Novo Item
                    </h2>
                    <input type="hidden" id="item-id">

                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">C√≥digo</label>
                                <input type="text" id="item-codigo"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                    placeholder="C√≥digo do item">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Nome</label>
                                <input type="text" id="item-nome"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                    placeholder="Nome do item">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">Descri√ß√£o</label>
                            <textarea id="item-descricao" rows="3"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                placeholder="Descri√ß√£o detalhada..."></textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Categoria</label>
                                <input type="text" id="item-categoria"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                    placeholder="Categoria">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Unidade</label>
                                <select id="item-unidade"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm">
                                    <option value="UN">UN - Unidade</option>
                                    <option value="P√á">P√á - Pe√ßa</option>
                                    <option value="MT">MT - Metro</option>
                                    <option value="M2">M¬≤ - Metro Quadrado</option>
                                    <option value="M3">M¬≥ - Metro C√∫bico</option>
                                    <option value="KG">KG - Quilograma</option>
                                    <option value="TON">TON - Tonelada</option>
                                    <option value="L">L - Litro</option>
                                    <option value="CX">CX - Caixa</option>
                                    <option value="PC">PC - Pacote</option>
                                    <option value="GL">GL - Gal√£o</option>
                                    <option value="FD">FD - Fardo</option>
                                    <option value="JR">JR - Jogo</option>
                                    <option value="PAR">PAR - Par</option>
                                    <option value="KIT">KIT - Kit</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Valor Unit√°rio</label>
                                <input type="number" id="item-valor" step="0.01" min="0"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                    placeholder="0,00">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Custo</label>
                                <input type="number" id="item-custo" step="0.01" min="0"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                    placeholder="0,00">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Fornecedor</label>
                                <input type="text" id="item-fornecedor"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                    placeholder="Fornecedor">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">C√≥d. Fornecedor</label>
                                <input type="text" id="item-cod-fornecedor"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                    placeholder="C√≥digo do fornecedor">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Estoque M√≠nimo</label>
                                <input type="number" id="item-estoque-min" step="1" min="0"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                    placeholder="0">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 mb-1 block">Estoque Atual</label>
                                <input type="number" id="item-estoque-atual" step="1" min="0"
                                    class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                    placeholder="0">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs text-slate-400 mb-1 block">URL da Imagem</label>
                            <input type="text" id="item-imagem"
                                class="w-full bg-slate-900 p-3 rounded-lg border border-slate-800 text-sm"
                                placeholder="https://...">
                        </div>

                        <button onclick="salvarItem()" id="btn-salvar-item"
                            class="w-full bg-gradient-to-r from-emerald-600 to-green-600 py-4 rounded-xl font-bold hover:opacity-90 transition flex items-center justify-center gap-2">
                            <i class="fas fa-save"></i> SALVAR ITEM
                        </button>
                        <button onclick="limparItemForm()"
                            class="w-full bg-slate-800 py-3 rounded-xl text-xs hover:bg-slate-700 transition">
                            <i class="fas fa-times mr-1"></i> CANCELAR / NOVO
                        </button>
                    </div>
                </div>

                <!-- Lista de Itens -->
                <div class="lg:col-span-3 futuristic-card p-6 overflow-x-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg title-font text-cyan-400">
                            <i class="fas fa-boxes mr-2"></i>Cat√°logo de Itens
                        </h3>
                        <div class="flex gap-2">
                            <input type="text" id="search-item" oninput="filtrarItens()" placeholder="Buscar item..."
                                class="bg-slate-900 p-2 rounded-lg border border-slate-700 text-sm w-64">
                            <select id="filter-item-categoria" onchange="filtrarItens()"
                                class="bg-slate-900 p-2 rounded-lg border border-slate-700 text-sm">
                                <option value="">Todas categorias</option>
                            </select>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="text-slate-500 border-b border-slate-800 text-[10px] uppercase">
                                <tr>
                                    <th class="p-4 text-left">C√≥digo</th>
                                    <th class="p-4 text-left">Nome</th>
                                    <th class="p-4 text-left">Categoria</th>
                                    <th class="p-4 text-center">Unidade</th>
                                    <th class="p-4 text-right">Valor</th>
                                    <th class="p-4 text-center">Estoque</th>
                                    <th class="p-4 text-right">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="lista-itens-body"></tbody>
                        </table>
                    </div>

                    <div id="itens-pagination" class="mt-4 flex justify-center gap-2"></div>
                </div>
            </div>
        </section>

        <!-- Tab Hist√≥rico/Relat√≥rios -->
        <section id="tab-relatorios" class="hidden fade-in">
            <div class="futuristic-card p-6">
                <div class="flex flex-wrap gap-4 mb-8">
                    <div class="flex flex-col gap-1">
                        <label class="text-[10px] text-slate-500 font-bold uppercase">Data Inicial</label>
                        <input type="date" id="filtro-data-inicio" onchange="renderRelatorios()"
                            class="bg-slate-900 p-3 rounded-xl border border-slate-800 text-xs text-white">
                    </div>
                    <div class="flex flex-col gap-1">
                        <label class="text-[10px] text-slate-500 font-bold uppercase">Data Final</label>
                        <input type="date" id="filtro-data-fim" onchange="renderRelatorios()"
                            class="bg-slate-900 p-3 rounded-xl border border-slate-800 text-xs text-white">
                    </div>
                    <div class="flex flex-col gap-1">
                        <label class="text-[10px] text-slate-500 font-bold uppercase">Empresa</label>
                        <select id="filtro-empresa" onchange="renderRelatorios()"
                            class="bg-slate-900 p-3 rounded-xl border border-slate-800 text-xs text-white w-48">
                            <option value="">Todas</option>
                        </select>
                    </div>
                    <div class="flex flex-col gap-1">
                        <label class="text-[10px] text-slate-500 font-bold uppercase">Cliente</label>
                        <select id="filtro-cliente" onchange="renderRelatorios()"
                            class="bg-slate-900 p-3 rounded-xl border border-slate-800 text-xs text-white w-48">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="flex flex-col gap-1">
                        <label class="text-[10px] text-slate-500 font-bold uppercase">Status</label>
                        <select id="filtro-status" onchange="renderRelatorios()"
                            class="bg-slate-900 p-3 rounded-xl border border-slate-800 text-xs text-white">
                            <option value="">Todos</option>
                            <option value="pendente">Pendente</option>
                            <option value="em_analise">Em An√°lise</option>
                            <option value="aprovado">Aprovado</option>
                            <option value="reprovado">Reprovado</option>
                            <option value="finalizado">Finalizado</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="exportarRelatorio()"
                            class="bg-gradient-to-r from-cyan-600 to-blue-600 px-4 py-3 rounded-xl text-xs font-bold hover:opacity-90 transition">
                            <i class="fas fa-file-export mr-1"></i> Exportar
                        </button>
                    </div>
                </div>

                <!-- Estat√≠sticas -->
                <div class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-8">
                    <div class="info-card p-4 rounded-2xl">
                        <div class="text-[10px] text-cyan-500 font-bold uppercase tracking-widest">Total Or√ßamentos
                        </div>
                        <div class="text-2xl font-bold mt-2" id="total-orcamentos">0</div>
                    </div>
                    <div class="info-card p-4 rounded-2xl">
                        <div class="text-[10px] text-emerald-500 font-bold uppercase tracking-widest">Valor Total</div>
                        <div class="text-2xl font-bold mt-2 text-emerald-400" id="valor-total">R$ 0,00</div>
                    </div>
                    <div class="info-card p-4 rounded-2xl">
                        <div class="text-[10px] text-amber-500 font-bold uppercase tracking-widest">M√©dia por Or√ß.</div>
                        <div class="text-2xl font-bold mt-2 text-amber-400" id="media-orcamento">R$ 0,00</div>
                    </div>
                    <div class="info-card p-4 rounded-2xl">
                        <div class="text-[10px] text-purple-500 font-bold uppercase tracking-widest">Taxa Aprova√ß√£o
                        </div>
                        <div class="text-2xl font-bold mt-2 text-purple-400" id="taxa-aprovacao">0%</div>
                    </div>
                    <div class="info-card p-4 rounded-2xl">
                        <div class="text-[10px] text-cyan-500 font-bold uppercase tracking-widest">Total Itens</div>
                        <div class="text-2xl font-bold mt-2" id="total-itens-relatorio">0</div>
                    </div>
                    <div class="info-card p-4 rounded-2xl">
                        <div class="text-[10px] text-emerald-500 font-bold uppercase tracking-widest">Total Unidades
                        </div>
                        <div class="text-2xl font-bold mt-2 text-emerald-400" id="total-unidades">0</div>
                    </div>
                </div>

                <!-- Tabela de Or√ßamentos -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="text-slate-500 border-b border-slate-800 text-[10px] uppercase">
                            <tr>
                                <th class="p-4 text-left">N¬∫ / Data</th>
                                <th class="p-4 text-left">Empresa</th>
                                <th class="p-4 text-left">Cliente</th>
                                <th class="p-4 text-right">Valor</th>
                                <th class="p-4 text-center">Itens</th>
                                <th class="p-4 text-center">Status</th>
                                <th class="p-4 text-center">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="relatorio-body"></tbody>
                    </table>
                </div>

                <!-- Pagina√ß√£o -->
                <div id="relatorios-pagination" class="mt-6 flex justify-center gap-2"></div>
            </div>
        </section>
    </div>

    <!-- Calculadora Avan√ßada -->
    <div id="calc-container">
        <div class="flex justify-between items-center mb-3">
            <div class="flex items-center gap-2">
                <span class="text-[10px] font-bold text-cyan-400 tracking-widest">CALCULADORA</span>
                <div class="flex gap-1">
                    <button onclick="copiarResultadoCalc()" class="text-xs bg-slate-800 px-2 py-1 rounded text-[10px]"
                        title="Copiar resultado">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button onclick="inserirNaDescricao()" class="text-xs bg-slate-800 px-2 py-1 rounded text-[10px]"
                        title="Inserir na descri√ß√£o">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="toggleCalcMode()" id="calc-mode-btn"
                    class="text-xs bg-slate-800 px-2 py-1 rounded text-[10px]" title="Alternar modo">
                    <i class="fas fa-calculator"></i>
                </button>
                <button onclick="toggleCalc()" class="text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <input type="text" id="calc-display" readonly
            class="w-full bg-slate-900 border border-slate-700 p-3 text-right mb-3 rounded-lg font-mono text-cyan-400 text-xl font-bold">

        <div class="grid grid-cols-5 gap-2">
            <!-- Linha 1 -->
            <button onclick="calcMemoryClear()" class="calc-btn bg-amber-900/50" title="Limpar mem√≥ria">MC</button>
            <button onclick="calcMemoryRecall()" class="calc-btn bg-amber-900/50" title="Recuperar mem√≥ria">MR</button>
            <button onclick="calcMemorySave()" class="calc-btn bg-amber-900/50" title="Salvar na mem√≥ria">M+</button>
            <button onclick="calcClearEntry()" class="calc-btn bg-red-900/50">CE</button>
            <button onclick="calcClear()" class="calc-btn bg-red-900/50">C</button>

            <!-- Linha 2 -->
            <button onclick="calcInput('7')" class="calc-btn">7</button>
            <button onclick="calcInput('8')" class="calc-btn">8</button>
            <button onclick="calcInput('9')" class="calc-btn">9</button>
            <button onclick="calcInput('/')" class="calc-btn bg-purple-900/50">/</button>
            <button onclick="calcBackspace()" class="calc-btn bg-slate-800" title="Backspace">
                <i class="fas fa-backspace"></i>
            </button>

            <!-- Linha 3 -->
            <button onclick="calcInput('4')" class="calc-btn">4</button>
            <button onclick="calcInput('5')" class="calc-btn">5</button>
            <button onclick="calcInput('6')" class="calc-btn">6</button>
            <button onclick="calcInput('*')" class="calc-btn bg-purple-900/50">√ó</button>
            <button onclick="calcPercentage()" class="calc-btn bg-slate-800">%</button>

            <!-- Linha 4 -->
            <button onclick="calcInput('1')" class="calc-btn">1</button>
            <button onclick="calcInput('2')" class="calc-btn">2</button>
            <button onclick="calcInput('3')" class="calc-btn">3</button>
            <button onclick="calcInput('-')" class="calc-btn bg-purple-900/50">-</button>
            <button onclick="calcInput('(')" class="calc-btn bg-slate-800">(</button>

            <!-- Linha 5 -->
            <button onclick="calcInput('0')" class="calc-btn">0</button>
            <button onclick="calcInput('.')" class="calc-btn">.</button>
            <button onclick="calcResult()" class="calc-btn bg-cyan-600 col-span-2">=</button>
            <button onclick="calcInput(')')" class="calc-btn bg-slate-800">)</button>

            <!-- Linha 6 -->
            <button onclick="calcInput('+')" class="calc-btn bg-purple-900/50 col-span-5">+</button>
        </div>

        <div class="mt-3 text-xs text-slate-500 text-center">
            <span id="memory-indicator" class="hidden bg-amber-900/30 px-2 py-1 rounded">M</span>
            <span id="calc-history" class="ml-2 text-cyan-400"></span>
        </div>

        <div class="mt-3 text-[8px] text-slate-600 text-center">
            <div>Teclado: N√∫meros e [+ - * / ( ) . Enter]</div>
        </div>
    </div>

    <!-- Bot√£o da Calculadora -->
    <button onclick="toggleCalc()"
        class="fixed bottom-6 right-6 bg-gradient-to-r from-cyan-500 to-blue-500 text-black w-16 h-16 rounded-full shadow-2xl flex items-center justify-center font-bold text-2xl hover:scale-110 transition z-[150] hover:rotate-12">
        <i class="fas fa-calculator"></i>
    </button>

    <!-- Template PDF -->
    <div id="pdf-template">
        <div class="flex justify-between items-center border-b-2 border-black pb-4 mb-8">
            <div>
                <img id="pdf-logo" src="" class="h-16">
                <div id="pdf-empresa-info" class="text-xs text-gray-600 mt-2"></div>
            </div>
            <div class="text-right">
                <h1 class="text-2xl font-black text-gray-900 uppercase">PROPOSTA COMERCIAL</h1>
                <p id="pdf-num" class="text-lg font-bold text-gray-800 mt-2"></p>
                <p id="pdf-data" class="text-sm text-gray-600 mt-1"></p>
                <p id="pdf-validade" class="text-sm text-gray-600"></p>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-8 mb-8">
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <p class="text-xs font-bold uppercase text-blue-900 mb-2">EMITENTE</p>
                <p id="pdf-emp-nome" class="font-bold text-lg text-black"></p>
                <p id="pdf-emp-cnpj" class="text-sm text-gray-600"></p>
                <p id="pdf-emp-endereco" class="text-sm text-gray-600 mt-1"></p>
                <p id="pdf-emp-contato" class="text-sm text-gray-600"></p>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <p class="text-xs font-bold uppercase text-blue-900 mb-2">CLIENTE</p>
                <p id="pdf-cli-nome" class="font-bold text-lg text-black"></p>
                <p id="pdf-cli-doc" class="text-sm text-gray-600"></p>
                <p id="pdf-cli-endereco" class="text-sm text-gray-600 mt-1"></p>
                <p id="pdf-cli-contato" class="text-sm text-gray-600"></p>
            </div>
        </div>

        <table class="pdf-table w-full mb-8">
            <thead>
                <tr>
                    <th class="w-12 text-center">UN</th>
                    <th class="w-16 text-center">QTD</th>
                    <th>DESCRI√á√ÉO T√âCNICA</th>
                    <th class="text-right w-24">UNIT√ÅRIO</th>
                    <th class="text-right w-24">TOTAL</th>
                </tr>
            </thead>
            <tbody id="pdf-itens-corpo"></tbody>
            <tfoot>
                <tr>
                    <td colspan="3" rowspan="3" class="align-top">
                        <div class="text-xs text-gray-600 mt-4">
                            <p class="font-bold mb-1">CONDI√á√ïES COMERCIAIS:</p>
                            <p id="pdf-cond-pagamento"></p>
                            <p id="pdf-cond-entrega" class="mt-1"></p>
                            <p id="pdf-cond-especiais" class="mt-1"></p>
                            <p class="font-bold mt-3 mb-1">OBSERVA√á√ïES:</p>
                            <p id="pdf-observacoes"></p>
                        </div>
                    </td>
                    <td class="text-right font-bold text-sm">SUBTOTAL:</td>
                    <td class="text-right font-bold" id="pdf-subtotal"></td>
                </tr>
                <tr>
                    <td class="text-right font-bold text-sm text-red-600">DESCONTO:</td>
                    <td class="text-right font-bold text-red-600" id="pdf-desconto"></td>
                </tr>
                <tr>
                    <td class="text-right font-bold text-sm text-blue-600">ACR√âSCIMO:</td>
                    <td class="text-right font-bold text-blue-600" id="pdf-acrescimo"></td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div class="text-xs text-gray-600 mt-2">
                            <p><strong>Quantidade de Itens:</strong> <span id="pdf-quantidade-itens">0</span></p>
                            <p><strong>Quantidade Total:</strong> <span id="pdf-quantidade-total">0</span> unidades</p>
                        </div>
                    </td>
                    <td class="text-right font-bold text-lg pt-4">TOTAL:</td>
                    <td class="text-right font-bold text-2xl pt-4" id="pdf-total"></td>
                </tr>
            </tfoot>
        </table>

        <div class="text-center text-xs text-gray-500 mt-12 pt-8 border-t border-gray-300">
            <p>Este or√ßamento √© v√°lido at√© a data indicada acima. Para efetivar a proposta, favor retornar assinado.</p>

            <!-- INFORMA√á√ïES DO REPRESENTANTE ADICIONADAS AQUI -->
            <div class="mt-6 pt-4 border-t border-gray-300">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-700">
                        <p class="font-bold">Representante e Distribuidor</p>
                        <p>Let√≠cia Maruyama</p>
                        <p>Tel: (62) 3289-4706 / 9.8130-0009</p>
                    </div>
                    <div class="text-right">
                        <!-- Logo da Arcecil -->
                        <img src="https://i.ibb.co/SDKZJ2gt/nova-logo.png" alt="Logo Arcecil" class="h-16 w-auto">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ïES E CONSTANTES
        // ============================================
        const BASEROW_TOKEN = 'Tf7ghRJ24mLS9g0fxGKUnhJjtfuxhFLh';
        const BASEROW_URL = 'https://api.baserow.io/api/database/rows/table/';

        // IDs das tabelas conforme Baserow
        let IDS = {
            empresas: '817147',
            clientes: '817153',
            itens: '817162',
            orcamentos: '817166',
            configuracoes: '817171'
        };

        let estado = {
            empresas: [],
            clientes: [],
            itens: [],
            orcamentos: [],
            configuracoes: {},
            orcamentoEditando: null,
            paginaClientes: 1,
            paginaItens: 1,
            paginaRelatorios: 1,
            itensPorPagina: 20
        };

        let itensImportados = [];
        let memoriaCalculadora = 0;
        let historicoCalculadora = [];
        let modoCalculadora = 'basico'; // 'basico' ou 'cientifica'
        let orcamentoAtualParaEmail = null;

        // ============================================
        // FUN√á√ïES DE TEMA
        // ============================================
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('theme-toggle');
            const darkIcon = themeToggle.querySelector('.dark-mode-icon');
            const lightIcon = themeToggle.querySelector('.light-mode-icon');

            if (body.classList.contains('theme-light')) {
                // Mudar para tema escuro
                body.classList.remove('theme-light');
                body.style.backgroundColor = '#0b1120';
                body.style.color = '#e2e8f0';
                darkIcon.classList.remove('hidden');
                lightIcon.classList.add('hidden');
                localStorage.setItem('theme', 'dark');
            } else {
                // Mudar para tema claro
                body.classList.add('theme-light');
                body.style.backgroundColor = '#f8fafc';
                body.style.color = '#1e293b';
                darkIcon.classList.add('hidden');
                lightIcon.classList.remove('hidden');
                localStorage.setItem('theme', 'light');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const themeToggle = document.getElementById('theme-toggle');
            const darkIcon = themeToggle.querySelector('.dark-mode-icon');
            const lightIcon = themeToggle.querySelector('.light-mode-icon');

            if (savedTheme === 'light') {
                document.body.classList.add('theme-light');
                document.body.style.backgroundColor = '#f8fafc';
                document.body.style.color = '#1e293b';
                darkIcon.classList.add('hidden');
                lightIcon.classList.remove('hidden');
            } else {
                document.body.classList.remove('theme-light');
                document.body.style.backgroundColor = '#0b1120';
                document.body.style.color = '#e2e8f0';
                darkIcon.classList.remove('hidden');
                lightIcon.classList.add('hidden');
            }
        }

        // ============================================
        // FUN√á√ïES DE DATA CORRIGIDAS (GMT-3 BRAS√çLIA)
        // ============================================
        function getDataAtualFormatada() {
            const data = new Date();
            // Ajustar para fuso hor√°rio brasileiro (GMT-3)
            const offsetBrasilia = -3 * 60; // -180 minutos para GMT-3
            const offsetLocal = data.getTimezoneOffset();
            const diferenca = offsetBrasilia - offsetLocal;

            // Adicionar a diferen√ßa em minutos
            data.setMinutes(data.getMinutes() + diferenca);

            const ano = data.getFullYear();
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const dia = String(data.getDate()).padStart(2, '0');

            return `${ano}-${mes}-${dia}`;
        }

        function formatarDataParaExibicao(dataString) {
            if (!dataString) return '--/--/----';

            const data = new Date(dataString + 'T12:00:00-03:00'); // For√ßar GMT-3
            const dia = String(data.getDate()).padStart(2, '0');
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const ano = data.getFullYear();

            return `${dia}/${mes}/${ano}`;
        }

        function formatarDataPDF(dataString) {
            if (!dataString) return '';

            const data = new Date(dataString + 'T12:00:00-03:00');
            const dia = String(data.getDate()).padStart(2, '0');
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const ano = data.getFullYear();

            return `${dia}/${mes}/${ano}`;
        }

        function adicionarDiasData(dataString, dias) {
            if (!dataString) return '';

            const data = new Date(dataString + 'T12:00:00-03:00');
            data.setDate(data.getDate() + dias);

            const ano = data.getFullYear();
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const dia = String(data.getDate()).padStart(2, '0');

            return `${ano}-${mes}-${dia}`;
        }

        function getDataHoraAtual() {
            const data = new Date();
            // Ajustar para fuso hor√°rio brasileiro
            const offsetBrasilia = -3 * 60;
            const offsetLocal = data.getTimezoneOffset();
            const diferenca = offsetBrasilia - offsetLocal;

            data.setMinutes(data.getMinutes() + diferenca);

            return data;
        }

        function validarData(dataString) {
            if (!dataString) return false;

            const data = new Date(dataString + 'T12:00:00-03:00');
            return !isNaN(data.getTime());
        }

        // ============================================
        // FUN√á√ïES DE API BASEROW
        // ============================================
        async function apiBaserow(method, tableId, data = null, rowId = null, params = {}) {
            if (!tableId) {
                console.error('ID da tabela n√£o configurado:', tableId);
                return null;
            }

            let url = rowId ?
                `${BASEROW_URL}${tableId}/${rowId}/?user_field_names=true` :
                `${BASEROW_URL}${tableId}/?user_field_names=true`;

            // Adicionar par√¢metros de pagina√ß√£o
            if (params.page) {
                url += `&page=${params.page}`;
            }
            if (params.size) {
                url += `&size=${params.size}`;
            }
            if (params.search) {
                url += `&search=${encodeURIComponent(params.search)}`;
            }

            const options = {
                method,
                headers: {
                    'Authorization': `Token ${BASEROW_TOKEN}`,
                    'Content-Type': 'application/json'
                }
            };

            if (data) options.body = JSON.stringify(data);

            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    throw new Error(`Erro ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Erro na API Baserow:', error);
                showError(`Erro na conex√£o: ${error.message}`);
                return null;
            }
        }

        // ============================================
        // FUN√á√ïES DE SINCRONIZA√á√ÉO
        // ============================================
        async function sincronizarTudo() {
            try {
                showLoading("Sincronizando dados...");

                // Atualizar status de conex√£o
                document.getElementById('connection-status').innerHTML =
                    '<span class="text-emerald-500">Conectando...</span>';

                // Carregar configura√ß√µes primeiro
                await carregarConfiguracoes();

                // Carregar dados das tabelas em paralelo
                const [empresasData, clientesData, itensData, orcamentosData] = await Promise.all([
                    apiBaserow('GET', IDS.empresas, null, null, { size: 100 }),
                    apiBaserow('GET', IDS.clientes, null, null, { size: 100 }),
                    apiBaserow('GET', IDS.itens, null, null, { size: 200 }),
                    apiBaserow('GET', IDS.orcamentos, null, null, { size: 100 })
                ]);

                estado.empresas = empresasData?.results || [];
                estado.clientes = clientesData?.results || [];
                estado.itens = itensData?.results || [];
                estado.orcamentos = orcamentosData?.results || [];

                // Ordenar or√ßamentos por data (mais recente primeiro)
                estado.orcamentos.sort((a, b) => new Date(b.data) - new Date(a.data));

                // Ordenar itens por nome
                estado.itens.sort((a, b) => a.nome?.localeCompare(b.nome) || 0);

                // Atualizar interface
                atualizarSelects();
                renderClientes();
                renderItens();
                renderRelatorios();
                renderEmpresas();

                // Configurar datas padr√£o
                configurarDatasPadrao();

                // Atualizar status de conex√£o
                document.getElementById('connection-status').innerHTML =
                    '<span class="text-emerald-500">Conectado</span> ' +
                    `<span class="text-slate-500">(${estado.orcamentos.length} or√ßamentos)</span>`;

                hideLoading();
                showSuccess("Dados sincronizados com sucesso!");

            } catch (error) {
                console.error('Erro ao sincronizar:', error);
                document.getElementById('connection-status').innerHTML =
                    '<span class="text-red-500">Offline</span>';
                showError("Erro ao carregar dados do servidor");
                hideLoading();
            }
        }

        async function carregarConfiguracoes() {
            try {
                const response = await apiBaserow('GET', IDS.configuracoes, null, null, { size: 100 });
                if (response && response.results) {
                    estado.configuracoes = {};
                    response.results.forEach(config => {
                        estado.configuracoes[config.chave] = config.valor;
                    });

                    // Aplicar configura√ß√µes
                    aplicarConfiguracoes();
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
            }
        }

        function aplicarConfiguracoes() {
            // Aplicar tema
            const tema = estado.configuracoes['tema'] || 'dark';
            aplicarTema(tema);

            // Configurar datas padr√£o
            configurarDatasPadrao();
        }

        function aplicarTema(tema) {
            // Remover classes de tema anteriores
            document.body.classList.remove('theme-light', 'theme-blue', 'theme-purple');

            // Aplicar novo tema
            if (tema === 'light') {
                document.body.classList.add('theme-light');
                document.body.style.backgroundColor = '#f8fafc';
                document.body.style.color = '#1e293b';
            } else if (tema === 'blue') {
                document.body.classList.add('theme-blue');
                document.body.style.backgroundColor = '#0c4a6e';
            } else if (tema === 'purple') {
                document.body.classList.add('theme-purple');
                document.body.style.backgroundColor = '#4c1d95';
            }
        }

        function configurarDatasPadrao() {
            const dataAtual = getDataAtualFormatada();

            // Data do or√ßamento (hoje)
            document.getElementById('orcamento-data').value = dataAtual;

            // Data de validade (hoje + dias de validade padr√£o)
            const diasValidade = parseInt(estado.configuracoes['dias_validade'] || '10');
            const dataValidade = adicionarDiasData(dataAtual, diasValidade);
            document.getElementById('orcamento-validade').value = dataValidade;

            // Configurar filtros de data no relat√≥rio para o m√™s atual
            const primeiroDiaMes = dataAtual.substring(0, 8) + '01';
            const ultimoDiaMes = adicionarDiasData(dataAtual.substring(0, 8) + '01', 31);

            // Garantir que √© o √∫ltimo dia do m√™s atual
            const dataUltimoDia = new Date(ultimoDiaMes + 'T12:00:00-03:00');
            while (dataUltimoDia.getMonth() === new Date(ultimoDiaMes + 'T12:00:00-03:00').getMonth()) {
                dataUltimoDia.setDate(dataUltimoDia.getDate() - 1);
            }

            const anoUltimo = dataUltimoDia.getFullYear();
            const mesUltimo = String(dataUltimoDia.getMonth() + 1).padStart(2, '0');
            const diaUltimo = String(dataUltimoDia.getDate()).padStart(2, '0');
            const ultimoDiaCorreto = `${anoUltimo}-${mesUltimo}-${diaUltimo}`;

            // Preencher filtros de data no relat√≥rio
            if (!document.getElementById('filtro-data-inicio').value) {
                document.getElementById('filtro-data-inicio').value = primeiroDiaMes;
                document.getElementById('filtro-data-fim').value = ultimoDiaCorreto;
            }

            // N√∫mero do or√ßamento
            gerarNumeroOrcamento();
        }

        function gerarNumeroOrcamento() {
            const formato = estado.configuracoes['formato_numero'] || 'ORC-{ANO}{MES}{DIA}-{NUM}';
            const dataAtual = getDataAtualFormatada();
            const [ano, mes, dia] = dataAtual.split('-');
            const contador = estado.orcamentos.filter(o => {
                const dataOrc = o.data ? o.data.substring(0, 10) : '';
                return dataOrc === dataAtual;
            }).length + 1;

            const numero = String(contador).padStart(4, '0');

            let numeroOrcamento = formato
                .replace(/{ANO}/g, ano)
                .replace(/{MES}/g, mes)
                .replace(/{DIA}/g, dia)
                .replace(/{NUM}/g, numero)
                .replace(/{DATA}/g, `${ano}${mes}${dia}`);

            document.getElementById('orcamento-numero').value = numeroOrcamento;
            return numeroOrcamento;
        }

        // ============================================
        // FUN√á√ïES DE OR√áAMENTO
        // ============================================
        function addItem() {
            const id = Date.now() + Math.random();
            const tr = document.createElement('tr');
            tr.id = `row-${id}`;
            tr.className = 'item-row';
            tr.innerHTML = `
                <td class="py-3">
                    <select class="un bg-slate-900 w-full text-xs uppercase border border-slate-700 rounded px-2 py-2">
                        <option value="UN">UN</option>
                        <option value="P√á">P√á</option>
                        <option value="MT">MT</option>
                        <option value="M2">M¬≤</option>
                        <option value="M3">M¬≥</option>
                        <option value="KG">KG</option>
                        <option value="TON">TON</option>
                        <option value="L">L</option>
                        <option value="CX">CX</option>
                        <option value="PC">PC</option>
                    </select>
                </td>
                <td class="text-center">
                    <input type="number" oninput="calcularItem(this)" 
                           class="qtd bg-slate-900 w-full text-center font-bold border border-slate-700 rounded px-2 py-2" 
                           value="1" min="0" step="0.01">
                </td>
                <td>
                    <div class="flex gap-2">
                        <input type="text" class="desc bg-slate-900 w-full border border-slate-700 rounded px-2 py-2" 
                               placeholder="Descri√ß√£o do item" onkeyup="buscarItensCatalogo(this)">
                        <div class="catalogo-sugestoes hidden absolute z-50 bg-slate-800 border border-slate-700 rounded-lg mt-10 w-96 max-h-60 overflow-y-auto"></div>
                    </div>
                </td>
                <td>
                    <input type="number" oninput="calcularItem(this)" 
                           class="val bg-slate-900 w-full text-right font-bold border border-slate-700 rounded px-2 py-2" 
                           placeholder="0.00" min="0" step="0.01">
                </td>
                <td class="text-right font-bold text-emerald-400 item-total">R$ 0,00</td>
                <td class="text-right">
                    <button onclick="document.getElementById('row-${id}').remove(); calcularTotalOrcamento()" 
                            class="text-red-500 hover:text-red-400 font-bold px-3 py-1 rounded bg-slate-800/50">
                        <i class="fas fa-times"></i>
                    </button>
                </td>
            `;
            document.getElementById('lista-itens').appendChild(tr);

            // Adicionar evento de busca para o novo item
            const descInput = tr.querySelector('.desc');
            descInput.addEventListener('input', function () {
                buscarItensCatalogo(this);
            });

            calcularTotalOrcamento();
            atualizarEstatisticasQuantidade();
        }

        function buscarItensCatalogo(inputElement) {
            const termo = inputElement.value.toLowerCase();
            if (termo.length < 2) {
                const sugestoesDiv = inputElement.nextElementSibling;
                sugestoesDiv.classList.add('hidden');
                return;
            }

            const itensFiltrados = estado.itens.filter(item =>
                item.nome?.toLowerCase().includes(termo) ||
                item.descricao?.toLowerCase().includes(termo) ||
                item.codigo?.toLowerCase().includes(termo)
            ).slice(0, 5);

            const sugestoesDiv = inputElement.nextElementSibling;
            sugestoesDiv.innerHTML = '';

            if (itensFiltrados.length === 0) {
                sugestoesDiv.classList.add('hidden');
                return;
            }

            itensFiltrados.forEach(item => {
                const div = document.createElement('div');
                div.className = 'p-3 border-b border-slate-700 hover:bg-slate-700 cursor-pointer';
                div.innerHTML = `
                    <div class="font-bold text-sm">${item.nome}</div>
                    <div class="text-xs text-slate-400">${item.descricao?.substring(0, 50)}...</div>
                    <div class="text-xs text-emerald-400 mt-1">R$ ${parseFloat(item.valor_unitario || 0).toFixed(2)}</div>
                `;
                div.onclick = function () {
                    inputElement.value = item.nome;
                    const row = inputElement.closest('tr');
                    row.querySelector('.val').value = item.valor_unitario || 0;
                    row.querySelector('.un').value = item.unidade_medida || 'UN';
                    sugestoesDiv.classList.add('hidden');
                    calcularItem(inputElement);
                };
                sugestoesDiv.appendChild(div);
            });

            sugestoesDiv.classList.remove('hidden');
        }

        function calcularItem(inputElement) {
            const row = inputElement.closest('tr');
            const qtd = parseFloat(row.querySelector('.qtd').value) || 0;
            const val = parseFloat(row.querySelector('.val').value) || 0;
            const total = qtd * val;

            row.querySelector('.item-total').textContent =
                `R$ ${total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

            calcularTotalOrcamento();
            atualizarEstatisticasQuantidade();
        }

        function calcularTotalOrcamento() {
            let subtotal = 0;
            let totalItens = 0;

            document.querySelectorAll('.item-row').forEach(row => {
                const qtd = parseFloat(row.querySelector('.qtd').value) || 0;
                const val = parseFloat(row.querySelector('.val').value) || 0;
                subtotal += qtd * val;
                if (qtd > 0 && val > 0) totalItens++;
            });

            // Atualizar subtotal
            document.getElementById('subtotal-geral').textContent =
                `R$ ${subtotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;

            // Calcular desconto e acr√©scimo
            const descontoPercentual = parseFloat(document.getElementById('desconto-percentual').value) || 0;
            const acrescimoPercentual = parseFloat(document.getElementById('acrescimo-percentual').value) || 0;

            const descontoValor = subtotal * (descontoPercentual / 100);
            const acrescimoValor = subtotal * (acrescimoPercentual / 100);

            document.getElementById('desconto-valor').textContent =
                `R$ ${descontoValor.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('acrescimo-valor').textContent =
                `R$ ${acrescimoValor.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;

            // Calcular total
            const total = subtotal - descontoValor + acrescimoValor;

            document.getElementById('total-geral').textContent =
                `R$ ${total.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('total-itens').textContent = `${totalItens} itens`;

            // Atualizar status
            const status = estado.orcamentoEditando?.status || 'pendente';
            document.getElementById('status-orcamento').textContent = status.charAt(0).toUpperCase() + status.slice(1);

            return { subtotal, descontoValor, acrescimoValor, total };
        }

        function atualizarEstatisticasQuantidade() {
            let quantidadeItens = 0;
            let quantidadeTotal = 0;
            let mediaQuantidade = 0;

            document.querySelectorAll('.item-row').forEach(row => {
                const qtd = parseFloat(row.querySelector('.qtd').value) || 0;
                const val = parseFloat(row.querySelector('.val').value) || 0;
                if (qtd > 0 && val > 0) {
                    quantidadeItens++;
                    quantidadeTotal += qtd;
                }
            });

            if (quantidadeItens > 0) {
                mediaQuantidade = quantidadeTotal / quantidadeItens;
            }

            // Atualizar estat√≠sticas na interface
            document.getElementById('stats-quantidade-itens').textContent = quantidadeItens;
            document.getElementById('stats-quantidade-total').textContent = quantidadeTotal.toFixed(2);
            document.getElementById('stats-media-quantidade').textContent = mediaQuantidade.toFixed(2);
            document.getElementById('widget-quantidade').textContent = quantidadeItens;

            return { quantidadeItens, quantidadeTotal, mediaQuantidade };
        }

        function calcularDesconto() {
            calcularTotalOrcamento();
        }

        function calcularAcrescimo() {
            calcularTotalOrcamento();
        }

        async function salvarOrcamento() {
            const empresaId = document.getElementById('sel-empresa').value;
            const clienteId = document.getElementById('sel-cliente').value;

            if (!empresaId || !clienteId) {
                showError("Selecione uma empresa e um cliente!");
                return;
            }

            const empresa = estado.empresas.find(e => e.id == empresaId);
            const cliente = estado.clientes.find(c => c.id == clienteId);

            if (!empresa || !cliente) {
                showError("Empresa ou cliente n√£o encontrado!");
                return;
            }

            // Coletar dados do or√ßamento
            const dadosCalculados = calcularTotalOrcamento();
            const estatisticasQuantidade = atualizarEstatisticasQuantidade();
            const numeroOrcamento = document.getElementById('orcamento-numero').value || gerarNumeroOrcamento();
            const dataOrcamento = document.getElementById('orcamento-data').value;
            const dataValidade = document.getElementById('orcamento-validade').value;
            const condPagamento = document.getElementById('cond-pagamento').value;
            const condEntrega = document.getElementById('cond-entrega').value;
            const condEspeciais = document.getElementById('cond-especiais').value;
            const observacoes = document.getElementById('orcamento-observacoes').value;

            // Coletar itens
            const itens = [];
            document.querySelectorAll('.item-row').forEach(row => {
                const descricao = row.querySelector('.desc').value;
                if (descricao.trim()) {
                    itens.push({
                        unidade: row.querySelector('.un').value || 'UN',
                        quantidade: parseFloat(row.querySelector('.qtd').value) || 0,
                        descricao: descricao,
                        valor_unitario: parseFloat(row.querySelector('.val').value) || 0
                    });
                }
            });

            if (itens.length === 0) {
                showError("Adicione pelo menos um item ao or√ßamento!");
                return;
            }

            // Status - usar status atual se estiver editando, sen√£o usar status inicial
            let statusOrcamento;
            if (estado.orcamentoEditando) {
                statusOrcamento = estado.orcamentoEditando.status || 'pendente';
            } else {
                statusOrcamento = estado.configuracoes['status_inicial'] || 'pendente';
            }

            // Preparar dados com colunas de quantidade
            const orcamentoData = {
                "numero": numeroOrcamento,
                "empresa": empresa.nome || empresa.razao_social || '',
                "cliente": cliente.nome || '',
                "data": dataOrcamento,
                "validade": dataValidade,
                "observacoes": observacoes || '',
                "condicoes_pagamento": condPagamento || '',
                "prazo_entrega": condEntrega || '',
                "forma_pagamento": condPagamento || '',
                "itens_json": JSON.stringify(itens),
                "quantidade_itens": estatisticasQuantidade.quantidadeItens,
                "quantidade_total": parseFloat(estatisticasQuantidade.quantidadeTotal.toFixed(2)),
                "subtotal": parseFloat(dadosCalculados.subtotal.toFixed(2)),
                "desconto_geral": parseFloat(dadosCalculados.descontoValor.toFixed(2)),
                "acrescimo_geral": parseFloat(dadosCalculados.acrescimoValor.toFixed(2)),
                "total": parseFloat(dadosCalculados.total.toFixed(2)),
                "status": statusOrcamento,
                "pdf_url": "",
                "data_cadastro": getDataAtualFormatada()
            };

            console.log("Dados do or√ßamento a serem enviados:", orcamentoData);

            try {
                showLoading("Salvando or√ßamento...");

                // Se estiver editando um or√ßamento existente
                if (estado.orcamentoEditando) {
                    const response = await apiBaserow('PATCH', IDS.orcamentos, orcamentoData, estado.orcamentoEditando.id);
                    console.log("Resposta PATCH:", response);
                    showSuccess("‚úÖ OR√áAMENTO ATUALIZADO COM SUCESSO!");

                    // Atualizar o objeto local
                    Object.assign(estado.orcamentoEditando, orcamentoData);
                } else {
                    // Criar novo or√ßamento
                    const response = await apiBaserow('POST', IDS.orcamentos, orcamentoData);
                    console.log("Resposta POST:", response);
                    showSuccess("‚úÖ OR√áAMENTO SALVO COM SUCESSO!");

                    // Adicionar √† lista local
                    if (response) {
                        estado.orcamentos.unshift(response);
                    }
                }

                // Habilitar bot√£o de email
                document.getElementById('btn-enviar-email').disabled = false;

                // Atualizar interface
                atualizarSelects();
                renderRelatorios();

                // Atualizar status na interface
                document.getElementById('status-orcamento').textContent =
                    statusOrcamento.charAt(0).toUpperCase() + statusOrcamento.slice(1);

                showSuccess("‚úÖ OR√áAMENTO SALVO COM SUCESSO!");
                hideLoading();

            } catch (error) {
                console.error("Erro completo ao salvar or√ßamento:", error);
                showError(`Erro ao salvar or√ßamento: ${error.message}`);
                hideLoading();
            }
        }

        async function gerarPDF(salvar = false) {
            const empresaId = document.getElementById('sel-empresa').value;
            const clienteId = document.getElementById('sel-cliente').value;

            if (!empresaId || !clienteId) {
                showError("Selecione uma empresa e um cliente!");
                return;
            }

            const empresa = estado.empresas.find(e => e.id == empresaId);
            const cliente = estado.clientes.find(c => c.id == clienteId);

            if (!empresa || !cliente) {
                showError("Empresa ou cliente n√£o encontrado!");
                return;
            }

            // Coletar dados
            const dadosCalculados = calcularTotalOrcamento();
            const estatisticasQuantidade = atualizarEstatisticasQuantidade();
            const numeroOrcamento = document.getElementById('orcamento-numero').value;
            const dataOrcamento = document.getElementById('orcamento-data').value;
            const dataValidade = document.getElementById('orcamento-validade').value;
            const condPagamento = document.getElementById('cond-pagamento').value;
            const condEntrega = document.getElementById('cond-entrega').value;
            const condEspeciais = document.getElementById('cond-especiais').value;
            const observacoes = document.getElementById('orcamento-observacoes').value;

            // Formatar datas usando a fun√ß√£o corrigida
            const dataFormatada = formatarDataPDF(dataOrcamento);
            const validadeFormatada = formatarDataPDF(dataValidade);

            // Preencher template PDF
            document.getElementById('pdf-logo').src = empresa.logo || '';

            // Mostrar CNPJ em vez de IE
            document.getElementById('pdf-empresa-info').innerHTML = `
                ${empresa.razao_social || ''}<br>
                ${empresa.CNPJ ? `CNPJ: ${formatarCNPJ(empresa.CNPJ)}` : ''}
            `;

            document.getElementById('pdf-num').textContent = `N¬∫: ${numeroOrcamento}`;
            document.getElementById('pdf-data').textContent = `Data: ${dataFormatada}`;
            document.getElementById('pdf-validade').textContent = `Validade: ${validadeFormatada}`;

            document.getElementById('pdf-emp-nome').textContent = empresa.nome || empresa.razao_social || '';
            document.getElementById('pdf-emp-cnpj').textContent = empresa.CNPJ ? `CNPJ: ${formatarCNPJ(empresa.CNPJ)}` : '';
            document.getElementById('pdf-emp-endereco').textContent =
                `${empresa.endere√ßo || ''} - ${empresa.cidade || ''}/${empresa.uf || ''}`;
            document.getElementById('pdf-emp-contato').textContent =
                `${empresa.telefone || ''} | ${empresa.email || ''}`;

            document.getElementById('pdf-cli-nome').textContent = cliente.nome || '';
            document.getElementById('pdf-cli-doc').textContent =
                cliente.tipo === 'Jur√≠dica' ? `CNPJ: ${formatarCNPJ(cliente.documento)}` : `CPF: ${formatarCPF(cliente.documento)}`;
            document.getElementById('pdf-cli-endereco').textContent =
                `${cliente.endere√ßo || ''} - ${cliente.cidade || ''}/${cliente.uf || ''}`;
            document.getElementById('pdf-cli-contato').textContent =
                `${cliente.telefone || ''} | ${cliente.email || ''}`;

            document.getElementById('pdf-cond-pagamento').textContent = condPagamento;
            document.getElementById('pdf-cond-entrega').textContent = condEntrega;
            document.getElementById('pdf-cond-especiais').textContent = condEspeciais;
            document.getElementById('pdf-observacoes').textContent = observacoes;

            // Adicionar estat√≠sticas de quantidade
            document.getElementById('pdf-quantidade-itens').textContent = estatisticasQuantidade.quantidadeItens;
            document.getElementById('pdf-quantidade-total').textContent = estatisticasQuantidade.quantidadeTotal.toFixed(2);

            // Adicionar itens
            const tbody = document.getElementById('pdf-itens-corpo');
            tbody.innerHTML = '';

            document.querySelectorAll('.item-row').forEach(row => {
                const un = row.querySelector('.un').value;
                const qtd = parseFloat(row.querySelector('.qtd').value) || 0;
                const desc = row.querySelector('.desc').value;
                const val = parseFloat(row.querySelector('.val').value) || 0;
                const total = qtd * val;

                tbody.innerHTML += `
                    <tr>
                        <td class="text-center">${un}</td>
                        <td class="text-center">${qtd}</td>
                        <td>${desc}</td>
                        <td class="text-right">R$ ${val.toFixed(2)}</td>
                        <td class="text-right">R$ ${total.toFixed(2)}</td>
                    </tr>
                `;
            });

            // Totais
            document.getElementById('pdf-subtotal').textContent = `R$ ${dadosCalculados.subtotal.toFixed(2)}`;
            document.getElementById('pdf-desconto').textContent = `R$ ${dadosCalculados.descontoValor.toFixed(2)}`;
            document.getElementById('pdf-acrescimo').textContent = `R$ ${dadosCalculados.acrescimoValor.toFixed(2)}`;
            document.getElementById('pdf-total').textContent = `R$ ${dadosCalculados.total.toFixed(2)}`;

            // Gerar PDF
            try {
                showLoading("Gerando PDF...");

                const canvas = await html2canvas(document.getElementById('pdf-template'), {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    logging: false
                });

                const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 297; // A4 height in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);

                if (salvar) {
                    // Upload do PDF para Baserow
                    const blob = pdf.output('blob');
                    const formData = new FormData();
                    formData.append('file', blob, `${numeroOrcamento}.pdf`);

                    const uploadResponse = await fetch('https://api.baserow.io/api/user-files/upload-file/', {
                        method: 'POST',
                        headers: { 'Authorization': `Token ${BASEROW_TOKEN}` },
                        body: formData
                    });

                    if (!uploadResponse.ok) {
                        throw new Error('Erro ao fazer upload do PDF');
                    }

                    const uploadData = await uploadResponse.json();

                    // Atualizar or√ßamento com URL do PDF
                    const orcamentoAtual = estado.orcamentoEditando ||
                        estado.orcamentos.find(o => o.numero === numeroOrcamento);

                    if (orcamentoAtual) {
                        await apiBaserow('PATCH', IDS.orcamentos, {
                            pdf_url: uploadData.url
                        }, orcamentoAtual.id);
                    }

                    // Baixar PDF
                    pdf.save(`${numeroOrcamento}.pdf`);

                    showSuccess("‚úÖ PDF GERADO E SALVO COM SUCESSO!");
                } else {
                    // Apenas visualizar
                    const pdfBlob = pdf.output('blob');
                    const pdfUrl = URL.createObjectURL(pdfBlob);
                    window.open(pdfUrl, '_blank');
                }

                hideLoading();

            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showError(`Erro ao gerar PDF: ${error.message}`);
                hideLoading();
            }
        }

        function formatarCNPJ(cnpj) {
            if (!cnpj) return '';
            const cleaned = cnpj.replace(/\D/g, '');
            return cleaned.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, "$1.$2.$3/$4-$5");
        }

        function formatarCPF(cpf) {
            if (!cpf) return '';
            const cleaned = cpf.replace(/\D/g, '');
            return cleaned.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
        }

        function duplicarOrcamento() {
            if (!estado.orcamentoEditando) {
                showError("N√£o h√° or√ßamento para duplicar!");
                return;
            }

            // Gerar novo n√∫mero
            gerarNumeroOrcamento();

            // Limpar ID de edi√ß√£o
            estado.orcamentoEditando = null;

            showSuccess("Or√ßamento preparado para duplica√ß√£o. Altere os dados e salve.");
        }

        // ============================================
        // FUN√á√ïES DE CLIENTES
        // ============================================
        async function salvarCliente() {
            const id = document.getElementById('cli-id').value;
            const tipo = document.getElementById('cli-tipo').value;
            const documento = document.getElementById('cli-doc').value.replace(/\D/g, '');
            const nome = document.getElementById('cli-nome').value.trim();

            if (!nome) {
                showError("Informe o nome do cliente!");
                return;
            }

            if (!documento) {
                showError("Informe o CPF ou CNPJ!");
                return;
            }

            // Validar CPF/CNPJ
            if (tipo === 'F√≠sica' && documento.length !== 11) {
                showError("CPF deve ter 11 d√≠gitos!");
                return;
            }

            if (tipo === 'Jur√≠dica' && documento.length !== 14) {
                showError("CNPJ deve ter 14 d√≠gitos!");
                return;
            }

            const clienteData = {
                nome: nome,
                tipo: tipo,
                documento: documento,
                email: document.getElementById('cli-email').value.trim(),
                telefone: document.getElementById('cli-telefone').value.trim(),
                celular: document.getElementById('cli-celular').value.trim(),
                contato: document.getElementById('cli-contato').value.trim(),
                endere√ßo: document.getElementById('cli-endereco').value.trim(),
                cidade: document.getElementById('cli-cidade').value.trim(),
                uf: document.getElementById('cli-uf').value,
                cep: document.getElementById('cli-cep').value.trim(),
                observa√ß√µes: document.getElementById('cli-observacoes').value.trim(),
                data_cadastro: getDataAtualFormatada()
            };

            try {
                showLoading("Salvando cliente...");

                if (id) {
                    await apiBaserow('PATCH', IDS.clientes, clienteData, id);
                    showSuccess("‚úÖ CLIENTE ATUALIZADO COM SUCESSO!");
                } else {
                    await apiBaserow('POST', IDS.clientes, clienteData);
                    showSuccess("‚úÖ CLIENTE CADASTRADO COM SUCESSO!");
                }

                await sincronizarTudo();
                limparCliForm();
                hideLoading();

            } catch (error) {
                showError(`Erro ao salvar cliente: ${error.message}`);
                hideLoading();
            }
        }

        function editarCliente(id) {
            const cliente = estado.clientes.find(c => c.id == id);
            if (!cliente) return;

            document.getElementById('cli-id').value = cliente.id;
            document.getElementById('cli-tipo').value = cliente.tipo || 'F√≠sica';
            document.getElementById('cli-doc').value = cliente.documento || '';
            document.getElementById('cli-nome').value = cliente.nome || '';
            document.getElementById('cli-email').value = cliente.email || '';
            document.getElementById('cli-telefone').value = cliente.telefone || '';
            document.getElementById('cli-celular').value = cliente.celular || '';
            document.getElementById('cli-contato').value = cliente.contato || '';
            document.getElementById('cli-endereco').value = cliente.endere√ßo || '';
            document.getElementById('cli-cidade').value = cliente.cidade || '';
            document.getElementById('cli-uf').value = cliente.uf || '';
            document.getElementById('cli-cep').value = cliente.cep || '';
            document.getElementById('cli-observacoes').value = cliente.observa√ß√µes || '';

            document.getElementById('cli-form-title').innerHTML =
                '<i class="fas fa-user-edit mr-2"></i>Editando Cliente';
            document.getElementById('btn-salvar-cli').innerHTML =
                '<i class="fas fa-save mr-2"></i> ATUALIZAR CLIENTE';

            // Rolar para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function excluirCliente(id) {
            if (!confirm("Tem certeza que deseja excluir este cliente?")) return;

            try {
                showLoading("Excluindo cliente...");
                await apiBaserow('DELETE', IDS.clientes, null, id);
                showSuccess("‚úÖ CLIENTE EXCLU√çDO COM SUCESSO!");
                await sincronizarTudo();
                hideLoading();
            } catch (error) {
                showError(`Erro ao excluir cliente: ${error.message}`);
                hideLoading();
            }
        }

        function filtrarClientes() {
            const termo = document.getElementById('search-cliente').value.toLowerCase();
            const tipo = document.getElementById('filter-cliente-tipo').value;

            let filtrados = estado.clientes;

            if (termo) {
                filtrados = filtrados.filter(c =>
                    c.nome?.toLowerCase().includes(termo) ||
                    c.documento?.includes(termo) ||
                    c.email?.toLowerCase().includes(termo) ||
                    c.contato?.toLowerCase().includes(termo)
                );
            }

            if (tipo) {
                filtrados = filtrados.filter(c => c.tipo === tipo);
            }

            renderClientes(filtrados);
        }

        function limparCliForm() {
            document.getElementById('cli-id').value = '';
            document.getElementById('cli-tipo').value = 'F√≠sica';
            document.getElementById('cli-doc').value = '';
            document.getElementById('cli-nome').value = '';
            document.getElementById('cli-email').value = '';
            document.getElementById('cli-telefone').value = '';
            document.getElementById('cli-celular').value = '';
            document.getElementById('cli-contato').value = '';
            document.getElementById('cli-endereco').value = '';
            document.getElementById('cli-cidade').value = '';
            document.getElementById('cli-uf').value = '';
            document.getElementById('cli-cep').value = '';
            document.getElementById('cli-observacoes').value = '';

            document.getElementById('cli-form-title').innerHTML =
                '<i class="fas fa-user-plus mr-2"></i>Novo Cadastro';
            document.getElementById('btn-salvar-cli').innerHTML =
                '<i class="fas fa-save mr-2"></i> SALVAR CLIENTE';
        }

        // ============================================
        // FUN√á√ïES DE EMPRESAS
        // ============================================
        async function salvarEmpresa() {
            const id = document.getElementById('emp-id').value;
            const nome = document.getElementById('emp-nome').value.trim();
            const cnpj = document.getElementById('emp-cnpj').value.replace(/\D/g, '');

            if (!nome) {
                showError("Informe o nome da empresa!");
                return;
            }

            if (!cnpj || cnpj.length !== 14) {
                showError("Informe um CNPJ v√°lido (14 d√≠gitos)!");
                return;
            }

            // Usar os nomes exatos das colunas do Baserow
            const empresaData = {
                "nome": nome,
                "razao_social": document.getElementById('emp-razao-social').value.trim(),
                "CNPJ": cnpj,
                "ie": document.getElementById('emp-ie').value.trim(),
                "email": document.getElementById('emp-email').value.trim(),
                "telefone": document.getElementById('emp-telefone').value.trim(),
                "site": document.getElementById('emp-site').value.trim(),
                "endere√ßo": document.getElementById('emp-endereco').value.trim(),
                "cidade": document.getElementById('emp-cidade').value.trim(),
                "uf": document.getElementById('emp-uf').value,
                "cep": document.getElementById('emp-cep').value.trim(),
                "logo": document.getElementById('emp-logo').value.trim(),
                "data_cadastro": getDataAtualFormatada()
            };

            console.log("Dados sendo enviados:", empresaData);

            try {
                showLoading("Salvando empresa...");

                if (id) {
                    const response = await apiBaserow('PATCH', IDS.empresas, empresaData, id);
                    console.log("Resposta PATCH:", response);
                    showSuccess("‚úÖ EMPRESA ATUALIZADA COM SUCESSO!");
                } else {
                    const response = await apiBaserow('POST', IDS.empresas, empresaData);
                    console.log("Resposta POST:", response);
                    showSuccess("‚úÖ EMPRESA CADASTRADA COM SUCESSO!");
                }

                await sincronizarTudo();
                limparEmpForm();
                hideLoading();

            } catch (error) {
                console.error("Erro completo:", error);
                showError(`Erro ao salvar empresa: ${error.message}`);
                hideLoading();
            }
        }

        function editarEmpresa(id) {
            const empresa = estado.empresas.find(e => e.id == id);
            if (!empresa) return;

            document.getElementById('emp-id').value = empresa.id;
            document.getElementById('emp-nome').value = empresa.nome || '';
            document.getElementById('emp-razao-social').value = empresa.razao_social || '';
            document.getElementById('emp-cnpj').value = empresa.CNPJ || '';
            document.getElementById('emp-ie').value = empresa.ie || '';
            document.getElementById('emp-email').value = empresa.email || '';
            document.getElementById('emp-telefone').value = empresa.telefone || '';
            document.getElementById('emp-site').value = empresa.site || '';
            document.getElementById('emp-endereco').value = empresa.endere√ßo || '';
            document.getElementById('emp-cidade').value = empresa.cidade || '';
            document.getElementById('emp-uf').value = empresa.uf || '';
            document.getElementById('emp-cep').value = empresa.cep || '';
            document.getElementById('emp-logo').value = empresa.logo || '';

            document.getElementById('emp-form-title').innerHTML =
                '<i class="fas fa-building mr-2"></i>Editando Empresa';
            document.getElementById('btn-salvar-emp').innerHTML =
                '<i class="fas fa-save mr-2"></i> ATUALIZAR EMPRESA';

            // Visualizar logo se existir
            if (empresa.logo) {
                visualizarLogo();
            }
        }

        function visualizarLogo() {
            const logoUrl = document.getElementById('emp-logo').value;
            if (logoUrl) {
                document.getElementById('logo-img').src = logoUrl;
                document.getElementById('logo-preview').classList.remove('hidden');
            }
        }

        async function excluirEmpresa(id) {
            if (!confirm("Tem certeza que deseja excluir esta empresa?")) return;

            try {
                showLoading("Excluindo empresa...");
                await apiBaserow('DELETE', IDS.empresas, null, id);
                showSuccess("‚úÖ EMPRESA EXCLU√çDA COM SUCESSO!");
                await sincronizarTudo();
                hideLoading();
            } catch (error) {
                showError(`Erro ao excluir empresa: ${error.message}`);
                hideLoading();
            }
        }

        function limparEmpForm() {
            document.getElementById('emp-id').value = '';
            document.getElementById('emp-nome').value = '';
            document.getElementById('emp-razao-social').value = '';
            document.getElementById('emp-cnpj').value = '';
            document.getElementById('emp-ie').value = '';
            document.getElementById('emp-email').value = '';
            document.getElementById('emp-telefone').value = '';
            document.getElementById('emp-site').value = '';
            document.getElementById('emp-endereco').value = '';
            document.getElementById('emp-cidade').value = '';
            document.getElementById('emp-uf').value = '';
            document.getElementById('emp-cep').value = '';
            document.getElementById('emp-logo').value = '';
            document.getElementById('logo-preview').classList.add('hidden');

            document.getElementById('emp-form-title').innerHTML =
                '<i class="fas fa-building mr-2"></i>Empresa Emissora';
            document.getElementById('btn-salvar-emp').innerHTML =
                '<i class="fas fa-save mr-2"></i> SALVAR EMPRESA';
        }

        // ============================================
        // FUN√á√ïES DE ITENS/CAT√ÅLOGO
        // ============================================
        async function salvarItem() {
            const id = document.getElementById('item-id').value;
            const codigo = document.getElementById('item-codigo').value.trim();
            const nome = document.getElementById('item-nome').value.trim();
            const valor = parseFloat(document.getElementById('item-valor').value) || 0;

            if (!nome) {
                showError("Informe o nome do item!");
                return;
            }

            if (valor <= 0) {
                showError("Informe um valor maior que zero!");
                return;
            }

            const itemData = {
                c√≥digo: codigo,
                nome: nome,
                descricao: document.getElementById('item-descricao').value.trim(),
                categoria: document.getElementById('item-categoria').value.trim(),
                unidade_medida: document.getElementById('item-unidade').value,
                valor_unit√°rio: valor.toFixed(2),
                custo: parseFloat(document.getElementById('item-custo').value) || 0,
                fornecedor: document.getElementById('item-fornecedor').value.trim(),
                codigo_fornecedor: document.getElementById('item-cod-fornecedor').value.trim(),
                estoque_m√≠nimo: parseInt(document.getElementById('item-estoque-min').value) || 0,
                estoque_atual: parseInt(document.getElementById('item-estoque-atual').value) || 0,
                imagem_url: document.getElementById('item-imagem').value.trim(),
                data_cadastro: getDataAtualFormatada()
            };

            try {
                showLoading("Salvando item...");

                if (id) {
                    await apiBaserow('PATCH', IDS.itens, itemData, id);
                    showSuccess("‚úÖ ITEM ATUALIZADO COM SUCESSO!");
                } else {
                    await apiBaserow('POST', IDS.itens, itemData);
                    showSuccess("‚úÖ ITEM CADASTRADO COM SUCESSO!");
                }

                await sincronizarTudo();
                limparItemForm();
                hideLoading();

            } catch (error) {
                showError(`Erro ao salvar item: ${error.message}`);
                hideLoading();
            }
        }

        function editarItem(id) {
            const item = estado.itens.find(i => i.id == id);
            if (!item) return;

            document.getElementById('item-id').value = item.id;
            document.getElementById('item-codigo').value = item.c√≥digo || '';
            document.getElementById('item-nome').value = item.nome || '';
            document.getElementById('item-descricao').value = item.descricao || '';
            document.getElementById('item-categoria').value = item.categoria || '';
            document.getElementById('item-unidade').value = item.unidade_medida || 'UN';
            document.getElementById('item-valor').value = item.valor_unit√°rio || 0;
            document.getElementById('item-custo').value = item.custo || 0;
            document.getElementById('item-fornecedor').value = item.fornecedor || '';
            document.getElementById('item-cod-fornecedor').value = item.codigo_fornecedor || '';
            document.getElementById('item-estoque-min').value = item.estoque_m√≠nimo || 0;
            document.getElementById('item-estoque-atual').value = item.estoque_atual || 0;
            document.getElementById('item-imagem').value = item.imagem_url || '';

            document.getElementById('item-form-title').innerHTML =
                '<i class="fas fa-edit mr-2"></i>Editando Item';
            document.getElementById('btn-salvar-item').innerHTML =
                '<i class="fas fa-save mr-2"></i> ATUALIZAR ITEM';
        }

        async function excluirItem(id) {
            if (!confirm("Tem certeza que deseja excluir este item?")) return;

            try {
                showLoading("Excluindo item...");
                await apiBaserow('DELETE', IDS.itens, null, id);
                showSuccess("‚úÖ ITEM EXCLU√çDO COM SUCESSO!");
                await sincronizarTudo();
                hideLoading();
            } catch (error) {
                showError(`Erro ao excluir item: ${error.message}`);
                hideLoading();
            }
        }

        function filtrarItens() {
            const termo = document.getElementById('search-item').value.toLowerCase();
            const categoria = document.getElementById('filter-item-categoria').value;

            let filtrados = estado.itens;

            if (termo) {
                filtrados = filtrados.filter(i =>
                    i.nome?.toLowerCase().includes(termo) ||
                    i.descricao?.toLowerCase().includes(termo) ||
                    i.c√≥digo?.toLowerCase().includes(termo) ||
                    i.categoria?.toLowerCase().includes(termo)
                );
            }

            if (categoria) {
                filtrados = filtrados.filter(i => i.categoria === categoria);
            }

            renderItens(filtrados);
        }

        function limparItemForm() {
            document.getElementById('item-id').value = '';
            document.getElementById('item-codigo').value = '';
            document.getElementById('item-nome').value = '';
            document.getElementById('item-descricao').value = '';
            document.getElementById('item-categoria').value = '';
            document.getElementById('item-unidade').value = 'UN';
            document.getElementById('item-valor').value = '';
            document.getElementById('item-custo').value = '';
            document.getElementById('item-fornecedor').value = '';
            document.getElementById('item-cod-fornecedor').value = '';
            document.getElementById('item-estoque-min').value = '';
            document.getElementById('item-estoque-atual').value = '';
            document.getElementById('item-imagem').value = '';

            document.getElementById('item-form-title').innerHTML =
                '<i class="fas fa-box mr-2"></i>Novo Item';
            document.getElementById('btn-salvar-item').innerHTML =
                '<i class="fas fa-save mr-2"></i> SALVAR ITEM';
        }

        // ============================================
        // FUN√á√ïES DE HIST√ìRICO/RELAT√ìRIOS
        // ============================================
        function renderRelatorios(filtrados = null) {
            const dataInicio = document.getElementById('filtro-data-inicio').value;
            const dataFim = document.getElementById('filtro-data-fim').value;
            const empresa = document.getElementById('filtro-empresa').value;
            const cliente = document.getElementById('filtro-cliente').value;
            const status = document.getElementById('filtro-status').value;

            let orcamentosFiltrados = filtrados || estado.orcamentos;

            // Aplicar filtros
            if (dataInicio) {
                orcamentosFiltrados = orcamentosFiltrados.filter(o => o.data >= dataInicio);
            }

            if (dataFim) {
                orcamentosFiltrados = orcamentosFiltrados.filter(o => o.data <= dataFim);
            }

            if (empresa) {
                orcamentosFiltrados = orcamentosFiltrados.filter(o => o.empresa === empresa);
            }

            if (cliente) {
                orcamentosFiltrados = orcamentosFiltrados.filter(o => o.cliente === cliente);
            }

            if (status) {
                orcamentosFiltrados = orcamentosFiltrados.filter(o => o.status === status);
            }

            // Calcular estat√≠sticas
            calcularEstatisticas(orcamentosFiltrados);

            // Renderizar tabela
            const tbody = document.getElementById('relatorio-body');

            if (orcamentosFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="p-8 text-center text-slate-500">
                            <i class="fas fa-search text-2xl mb-2"></i><br>
                            Nenhum or√ßamento encontrado com os filtros selecionados.
                        </td>
                    </tr>`;
                return;
            }

            // Pagina√ß√£o
            const itensPorPagina = 15;
            const totalPaginas = Math.ceil(orcamentosFiltrados.length / itensPorPagina);
            const paginaAtual = estado.paginaRelatorios;
            const inicio = (paginaAtual - 1) * itensPorPagina;
            const fim = inicio + itensPorPagina;
            const orcamentosPagina = orcamentosFiltrados.slice(inicio, fim);

            tbody.innerHTML = orcamentosPagina.map(orcamento => {
                // Determinar classe do status
                let statusClass = 'status-pendente';
                let statusIcon = '‚è≥';

                switch (orcamento.status) {
                    case 'aprovado':
                        statusClass = 'status-aprovado';
                        statusIcon = '‚úÖ';
                        break;
                    case 'reprovado':
                        statusClass = 'status-reprovado';
                        statusIcon = '‚ùå';
                        break;
                    case 'finalizado':
                        statusClass = 'status-finalizado';
                        statusIcon = 'üèÅ';
                        break;
                    case 'em_analise':
                        statusClass = 'status-pendente';
                        statusIcon = 'üîç';
                        break;
                    case 'cancelado':
                        statusClass = 'status-reprovado';
                        statusIcon = 'üö´';
                        break;
                    default:
                        statusClass = 'status-pendente';
                        statusIcon = '‚è≥';
                }

                // Formatar data
                const dataFormatada = formatarDataParaExibicao(orcamento.data);

                // Formatar valor
                const valor = parseFloat(orcamento.total || 0);
                const valorFormatado = valor.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });

                // Obter quantidade de itens
                const quantidadeItens = orcamento.quantidade_itens || 0;
                const quantidadeTotal = orcamento.quantidade_total || 0;

                return `
                    <tr class="border-b border-slate-800/50 hover:bg-slate-800/30 transition">
                        <td class="p-4">
                            <div class="font-bold text-sm text-cyan-400">${orcamento.numero || 'N/A'}</div>
                            <div class="text-[10px] text-slate-500">${dataFormatada}</div>
                        </td>
                        <td class="p-4 text-sm">${orcamento.empresa || '--'}</td>
                        <td class="p-4">
                            <div class="font-bold text-sm">${orcamento.cliente || '--'}</div>
                            <div class="text-[10px] text-slate-500 truncate max-w-[200px]">
                                ${orcamento.observacoes?.substring(0, 50) || 'Sem observa√ß√µes'}
                            </div>
                        </td>
                        <td class="p-4 text-right font-bold text-emerald-400">
                            R$ ${valorFormatado}
                        </td>
                        <td class="p-4 text-center">
                            <div class="flex flex-col items-center">
                                <span class="font-bold text-sm">${quantidadeItens}</span>
                                <span class="text-[10px] text-slate-500">(${quantidadeTotal} unid)</span>
                            </div>
                        </td>
                        <td class="p-4 text-center">
                            <span class="status-badge ${statusClass}">
                                ${statusIcon} ${orcamento.status || 'pendente'}
                            </span>
                        </td>
                        <td class="p-4 text-center">
                            <div class="flex flex-wrap gap-1 justify-center">
                                <button onclick="carregarOrcamentoParaEdicao(${orcamento.id})" 
                                        class="text-cyan-400 hover:text-cyan-300 text-xs px-2 py-1 rounded bg-slate-800/50 transition"
                                        title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="alterarStatusOrcamento(${orcamento.id}, 'aprovado')" 
                                        class="text-emerald-400 hover:text-emerald-300 text-xs px-2 py-1 rounded bg-slate-800/50 transition"
                                        title="Aprovar">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button onclick="alterarStatusOrcamento(${orcamento.id}, 'reprovado')" 
                                        class="text-red-400 hover:text-red-300 text-xs px-2 py-1 rounded bg-slate-800/50 transition"
                                        title="Reprovar">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button onclick="prepararEnvioEmailOrcamento(${orcamento.id})" 
                                        class="text-blue-400 hover:text-blue-300 text-xs px-2 py-1 rounded bg-slate-800/50 transition"
                                        title="Enviar email">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                                <button onclick="visualizarPDF(${orcamento.id})" 
                                        class="text-purple-400 hover:text-purple-300 text-xs px-2 py-1 rounded bg-slate-800/50 transition"
                                        title="Ver PDF">
                                    <i class="fas fa-file-pdf"></i>
                                </button>
                                <button onclick="excluirOrcamento(${orcamento.id})" 
                                        class="text-red-500 hover:text-red-400 text-xs px-2 py-1 rounded bg-slate-800/50 transition"
                                        title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>`;
            }).join('');

            // Renderizar pagina√ß√£o
            renderPaginacaoRelatorios(totalPaginas);
        }

        function calcularEstatisticas(orcamentos) {
            const total = orcamentos.length;
            const valorTotal = orcamentos.reduce((sum, o) => sum + parseFloat(o.total || 0), 0);
            const media = total > 0 ? valorTotal / total : 0;
            const aprovados = orcamentos.filter(o => o.status === 'aprovado').length;
            const taxaAprovacao = total > 0 ? (aprovados / total) * 100 : 0;

            // Calcular estat√≠sticas de quantidade
            let totalItens = 0;
            let totalUnidades = 0;

            orcamentos.forEach(o => {
                totalItens += parseInt(o.quantidade_itens || 0);
                totalUnidades += parseFloat(o.quantidade_total || 0);

                // Se n√£o tiver as colunas espec√≠ficas, calcular do JSON
                if (!o.quantidade_itens && o.itens_json) {
                    try {
                        const itens = JSON.parse(o.itens_json);
                        o.quantidade_itens = itens.length;
                        o.quantidade_total = itens.reduce((sum, item) => sum + (item.quantidade || 0), 0);
                        totalItens += itens.length;
                        totalUnidades += o.quantidade_total;
                    } catch (e) {
                        console.error('Erro ao parsear itens:', e);
                    }
                }
            });

            document.getElementById('total-orcamentos').textContent = total;
            document.getElementById('valor-total').textContent =
                `R$ ${valorTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('media-orcamento').textContent =
                `R$ ${media.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
            document.getElementById('taxa-aprovacao').textContent =
                `${taxaAprovacao.toFixed(1)}%`;
            document.getElementById('total-itens-relatorio').textContent = totalItens;
            document.getElementById('total-unidades').textContent = totalUnidades.toFixed(2);
        }

        function renderPaginacaoRelatorios(totalPaginas) {
            const container = document.getElementById('relatorios-pagination');
            const paginaAtual = estado.paginaRelatorios;

            if (totalPaginas <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = '';

            // Bot√£o anterior
            if (paginaAtual > 1) {
                html += `<button onclick="mudarPaginaRelatorios(${paginaAtual - 1})" 
                         class="px-3 py-1 rounded-lg bg-slate-800 hover:bg-slate-700">
                         <i class="fas fa-chevron-left"></i></button>`;
            }

            // P√°ginas
            const inicio = Math.max(1, paginaAtual - 2);
            const fim = Math.min(totalPaginas, paginaAtual + 2);

            for (let i = inicio; i <= fim; i++) {
                if (i === paginaAtual) {
                    html += `<button class="px-3 py-1 rounded-lg bg-cyan-600 text-white">${i}</button>`;
                } else {
                    html += `<button onclick="mudarPaginaRelatorios(${i})" 
                             class="px-3 py-1 rounded-lg bg-slate-800 hover:bg-slate-700">${i}</button>`;
                }
            }

            // Bot√£o pr√≥ximo
            if (paginaAtual < totalPaginas) {
                html += `<button onclick="mudarPaginaRelatorios(${paginaAtual + 1})" 
                         class="px-3 py-1 rounded-lg bg-slate-800 hover:bg-slate-700">
                         <i class="fas fa-chevron-right"></i></button>`;
            }

            container.innerHTML = html;
        }

        function mudarPaginaRelatorios(pagina) {
            estado.paginaRelatorios = pagina;
            renderRelatorios();
        }

        async function carregarOrcamentoParaEdicao(id) {
            const orcamento = estado.orcamentos.find(o => o.id == id);
            if (!orcamento) {
                showError("Or√ßamento n√£o encontrado!");
                return;
            }

            estado.orcamentoEditando = orcamento;

            // Encontrar empresa e cliente
            const empresa = estado.empresas.find(e => e.nome === orcamento.empresa);
            const cliente = estado.clientes.find(c => c.nome === orcamento.cliente);

            // Preencher formul√°rio
            if (empresa) {
                document.getElementById('sel-empresa').value = empresa.id;
            }

            if (cliente) {
                document.getElementById('sel-cliente').value = cliente.id;
            }

            document.getElementById('orcamento-numero').value = orcamento.numero;
            document.getElementById('orcamento-data').value = orcamento.data;
            document.getElementById('orcamento-validade').value = orcamento.validade;
            document.getElementById('cond-pagamento').value = orcamento.condicoes_pagamento || orcamento.forma_pagamento || '';
            document.getElementById('cond-entrega').value = orcamento.prazo_entrega || '';
            document.getElementById('cond-especiais').value = orcamento.condicoes_pagamento || '';
            document.getElementById('orcamento-observacoes').value = orcamento.observacoes || '';

            // Calcular percentuais de desconto e acr√©scimo
            const subtotal = parseFloat(orcamento.subtotal || 0);
            const descontoGeral = parseFloat(orcamento.desconto_geral || 0);
            const acrescimoGeral = parseFloat(orcamento.acrescimo_geral || 0);

            document.getElementById('desconto-percentual').value = subtotal > 0 ? ((descontoGeral / subtotal) * 100).toFixed(2) : 0;
            document.getElementById('acrescimo-percentual').value = subtotal > 0 ? ((acrescimoGeral / subtotal) * 100).toFixed(2) : 0;

            // Limpar e carregar itens
            document.getElementById('lista-itens').innerHTML = "";

            try {
                if (orcamento.itens_json) {
                    const itens = JSON.parse(orcamento.itens_json);
                    itens.forEach(item => {
                        addItem();
                        const rows = document.querySelectorAll('.item-row');
                        const lastRow = rows[rows.length - 1];
                        lastRow.querySelector('.un').value = item.unidade || 'UN';
                        lastRow.querySelector('.qtd').value = item.quantidade || 1;
                        lastRow.querySelector('.desc').value = item.descricao || '';
                        lastRow.querySelector('.val').value = item.valor_unitario || 0;
                        calcularItem(lastRow.querySelector('.desc'));
                    });
                } else {
                    addItem();
                }
            } catch (error) {
                console.error('Erro ao carregar itens:', error);
                addItem();
            }

            // Calcular total
            calcularTotalOrcamento();
            atualizarEstatisticasQuantidade();

            // Habilitar bot√£o de email
            document.getElementById('btn-enviar-email').disabled = false;

            // Atualizar status na interface
            document.getElementById('status-orcamento').textContent =
                orcamento.status.charAt(0).toUpperCase() + orcamento.status.slice(1);

            // Mudar para aba de or√ßamento
            switchTab('orcamento');

            showSuccess(`Or√ßamento ${orcamento.numero} carregado para edi√ß√£o!`);
        }

        async function alterarStatusOrcamento(orcamentoId, novoStatus) {
            if (!confirm(`Alterar status para ${novoStatus.toUpperCase()}?`)) return;

            try {
                await apiBaserow('PATCH', IDS.orcamentos, {
                    status: novoStatus,
                    ultima_atualizacao: getDataAtualFormatada()
                }, orcamentoId);

                showSuccess(`Status alterado para ${novoStatus}!`);

                // Atualizar localmente
                const orcamento = estado.orcamentos.find(o => o.id == orcamentoId);
                if (orcamento) {
                    orcamento.status = novoStatus;
                }

                // Se estiver editando este or√ßamento, atualizar interface
                if (estado.orcamentoEditando && estado.orcamentoEditando.id == orcamentoId) {
                    estado.orcamentoEditando.status = novoStatus;
                    document.getElementById('status-orcamento').textContent =
                        novoStatus.charAt(0).toUpperCase() + novoStatus.slice(1);
                }

                renderRelatorios();

            } catch (error) {
                showError(`Erro ao alterar status: ${error.message}`);
            }
        }

        async function excluirOrcamento(id) {
            if (!confirm("Tem certeza que deseja excluir este or√ßamento?\nEsta a√ß√£o n√£o pode ser desfeita.")) return;

            try {
                showLoading("Excluindo or√ßamento...");
                await apiBaserow('DELETE', IDS.orcamentos, null, id);
                showSuccess("‚úÖ OR√áAMENTO EXCLU√çDO COM SUCESSO!");

                // Remover localmente
                estado.orcamentos = estado.orcamentos.filter(o => o.id != id);
                if (estado.orcamentoEditando && estado.orcamentoEditando.id == id) {
                    estado.orcamentoEditando = null;
                    limparTelaOrcamento();
                }

                renderRelatorios();
                hideLoading();
            } catch (error) {
                showError(`Erro ao excluir or√ßamento: ${error.message}`);
                hideLoading();
            }
        }

        async function visualizarPDF(id) {
            const orcamento = estado.orcamentos.find(o => o.id == id);
            if (!orcamento) {
                showError("Or√ßamento n√£o encontrado!");
                return;
            }

            if (orcamento.pdf_url) {
                window.open(orcamento.pdf_url, '_blank');
            } else {
                showError("PDF n√£o dispon√≠vel para este or√ßamento.");
            }
        }

        function exportarRelatorio() {
            const dataInicio = document.getElementById('filtro-data-inicio').value;
            const dataFim = document.getElementById('filtro-data-fim').value;
            const empresa = document.getElementById('filtro-empresa').value;
            const cliente = document.getElementById('filtro-cliente').value;
            const status = document.getElementById('filtro-status').value;

            let orcamentosFiltrados = estado.orcamentos;

            // Aplicar filtros
            if (dataInicio) orcamentosFiltrados = orcamentosFiltrados.filter(o => o.data >= dataInicio);
            if (dataFim) orcamentosFiltrados = orcamentosFiltrados.filter(o => o.data <= dataFim);
            if (empresa) orcamentosFiltrados = orcamentosFiltrados.filter(o => o.empresa === empresa);
            if (cliente) orcamentosFiltrados = orcamentosFiltrados.filter(o => o.cliente === cliente);
            if (status) orcamentosFiltrados = orcamentosFiltrados.filter(o => o.status === status);

            // Criar CSV
            let csv = 'N√∫mero;Data;Empresa;Cliente;Itens;Quantidade Total;Subtotal;Desconto;Acr√©scimo;Total;Status;Observa√ß√µes\n';

            orcamentosFiltrados.forEach(o => {
                const linha = [
                    `"${o.numero || ''}"`,
                    `"${formatarDataParaExibicao(o.data) || ''}"`,
                    `"${o.empresa || ''}"`,
                    `"${o.cliente || ''}"`,
                    `"${o.quantidade_itens || '0'}"`,
                    `"${o.quantidade_total || '0'}"`,
                    `"${o.subtotal || '0'}"`,
                    `"${o.desconto_geral || '0'}"`,
                    `"${o.acrescimo_geral || '0'}"`,
                    `"${o.total || '0'}"`,
                    `"${o.status || ''}"`,
                    `"${(o.observacoes || '').replace(/"/g, '""')}"`
                ].join(';');

                csv += linha + '\n';
            });

            // Criar blob e baixar
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `relatorio_orcamentos_${getDataAtualFormatada()}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showSuccess("Relat√≥rio exportado com sucesso!");
        }

        // ============================================
        // FUN√á√ïES DE EMAIL
        // ============================================
        function prepararEnvioEmailOrcamento(orcamentoId) {
            const orcamento = estado.orcamentos.find(o => o.id == orcamentoId);
            if (!orcamento) return;

            orcamentoAtualParaEmail = orcamento;

            // Encontrar cliente para preencher email
            const cliente = estado.clientes.find(c => c.nome === orcamento.cliente);

            // Preencher modal de email
            document.getElementById('email-to').value = cliente?.email || '';
            document.getElementById('email-subject').value = `Or√ßamento ${orcamento.numero} - ${orcamento.empresa}`;

            // Preencher template de mensagem
            let mensagem = document.getElementById('email-message').value;
            mensagem = mensagem
                .replace(/\[NUMERO_ORCAMENTO\]/g, orcamento.numero)
                .replace(/\[DATA_ORCAMENTO\]/g, formatarDataParaExibicao(orcamento.data))
                .replace(/\[VALIDADE\]/g, formatarDataParaExibicao(orcamento.validade))
                .replace(/\[TOTAL\]/g, `R$ ${parseFloat(orcamento.total).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`)
                .replace(/\[FORMA_PAGAMENTO\]/g, orcamento.forma_pagamento || '')
                .replace(/\[PRAZO_ENTREGA\]/g, orcamento.prazo_entrega || '')
                .replace(/\[CONDICOES\]/g, orcamento.condicoes_pagamento || '')
                .replace(/\[EMPRESA_NOME\]/g, orcamento.empresa || '');

            document.getElementById('email-message').value = mensagem;

            // Abrir modal
            abrirEmailModal();
        }

        function abrirEmailModal() {
            document.getElementById('email-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function fecharEmailModal() {
            document.getElementById('email-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            orcamentoAtualParaEmail = null;
        }

        async function enviarEmailConfirmado() {
            const para = document.getElementById('email-to').value;
            const assunto = document.getElementById('email-subject').value;
            const mensagem = document.getElementById('email-message').value;

            if (!para) {
                showError("Informe o email do destinat√°rio!");
                return;
            }

            if (!orcamentoAtualParaEmail) {
                showError("Nenhum or√ßamento selecionado para envio!");
                return;
            }

            // Valida√ß√£o b√°sica de email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(para)) {
                showError("Informe um email v√°lido!");
                return;
            }

            try {
                showLoading("Enviando email...");

                // Aqui voc√™ implementaria a l√≥gica real de envio de email
                // Pode usar EmailJS, SendGrid, ou seu pr√≥prio backend
                // Por enquanto, vamos simular o envio

                // Verificar se h√° configura√ß√µes de email
                const smtpHost = estado.configuracoes['smtp_host'];
                const smtpUser = estado.configuracoes['smtp_user'];

                if (!smtpHost || !smtpUser) {
                    showError("Configure as credenciais de email nas Configura√ß√µes Avan√ßadas");
                    hideLoading();
                    return;
                }

                // Simula√ß√£o de envio (substituir por implementa√ß√£o real)
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Atualizar status no Baserow (marcar como enviado)
                await apiBaserow('PATCH', IDS.orcamentos, {
                    status: 'enviado'
                }, orcamentoAtualParaEmail.id);

                // Salvar template se solicitado
                const salvarTemplate = document.getElementById('email-save-template').checked;
                if (salvarTemplate) {
                    await salvarConfiguracao('email_template_orcamento', mensagem);
                }

                showSuccess("‚úÖ EMAIL ENVIADO COM SUCESSO!");
                fecharEmailModal();

                // Atualizar status localmente
                orcamentoAtualParaEmail.status = 'enviado';
                renderRelatorios();

                hideLoading();

            } catch (error) {
                showError(`Erro ao enviar email: ${error.message}`);
                hideLoading();
            }
        }

        async function salvarConfiguracao(chave, valor) {
            if (!IDS.configuracoes) return;

            try {
                // Verificar se j√° existe
                const configs = await apiBaserow('GET', IDS.configuracoes, null, null, { search: chave });
                const existente = configs?.results?.find(c => c.chave === chave);

                if (existente) {
                    // Atualizar
                    await apiBaserow('PATCH', IDS.configuracoes, {
                        valor: valor
                    }, existente.id);
                } else {
                    // Criar nova
                    await apiBaserow('POST', IDS.configuracoes, {
                        chave: chave,
                        valor: valor,
                        tipo: 'texto'
                    });
                }
            } catch (error) {
                console.error('Erro ao salvar configura√ß√£o:', error);
            }
        }

        function atualizarEmailCliente() {
            const clienteId = document.getElementById('sel-cliente').value;
            const cliente = estado.clientes.find(c => c.id == clienteId);

            if (cliente && cliente.email) {
                document.getElementById('email-to').value = cliente.email;
            }
        }

        // ============================================
        // FUN√á√ïES DE CONFIGURA√á√ïES AVAN√áADAS
        // ============================================
        function abrirConfigModal() {
            // Preencher valores atuais
            document.getElementById('config-id-empresas').value = IDS.empresas;
            document.getElementById('config-id-clientes').value = IDS.clientes;
            document.getElementById('config-id-itens').value = IDS.itens;
            document.getElementById('config-id-orcamentos').value = IDS.orcamentos;
            document.getElementById('config-id-configs').value = IDS.configuracoes;

            // Preencher configura√ß√µes de email
            document.getElementById('config-smtp-host').value = estado.configuracoes['smtp_host'] || '';
            document.getElementById('config-smtp-port').value = estado.configuracoes['smtp_port'] || '587';
            document.getElementById('config-smtp-user').value = estado.configuracoes['smtp_user'] || '';
            document.getElementById('config-smtp-password').value = estado.configuracoes['smtp_password'] || '';
            document.getElementById('config-email-from').value = estado.configuracoes['email_from'] || '';
            document.getElementById('config-email-teste').value = estado.configuracoes['email_teste'] || '';

            // Preencher configura√ß√µes gerais
            document.getElementById('config-dias-validade').value = estado.configuracoes['dias_validade'] || '10';
            document.getElementById('config-formato-num').value = estado.configuracoes['formato_numero'] || 'ORC-{ANO}{MES}{DIA}-{NUM}';
            document.getElementById('config-status-inicial').value = estado.configuracoes['status_inicial'] || 'pendente';
            document.getElementById('config-notificar-status').value = estado.configuracoes['notificar_status'] || 'todos';
            document.getElementById('config-tema').value = estado.configuracoes['tema'] || 'dark';
            document.getElementById('config-itens-pagina').value = estado.configuracoes['itens_pagina'] || '20';

            document.getElementById('config-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function fecharConfigModal() {
            document.getElementById('config-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        async function salvarConfiguracoesAvancadas() {
            // Coletar dados
            const configsParaSalvar = {
                'id_empresas': document.getElementById('config-id-empresas').value,
                'id_clientes': document.getElementById('config-id-clientes').value,
                'id_itens': document.getElementById('config-id-itens').value,
                'id_orcamentos': document.getElementById('config-id-orcamentos').value,
                'id_configuracoes': document.getElementById('config-id-configs').value,

                'smtp_host': document.getElementById('config-smtp-host').value,
                'smtp_port': document.getElementById('config-smtp-port').value,
                'smtp_user': document.getElementById('config-smtp-user').value,
                'smtp_password': document.getElementById('config-smtp-password').value,
                'email_from': document.getElementById('config-email-from').value,
                'email_teste': document.getElementById('config-email-teste').value,

                'dias_validade': document.getElementById('config-dias-validade').value,
                'formato_numero': document.getElementById('config-formato-num').value,
                'status_inicial': document.getElementById('config-status-inicial').value,
                'notificar_status': document.getElementById('config-notificar-status').value,
                'tema': document.getElementById('config-tema').value,
                'itens_pagina': document.getElementById('config-itens-pagina').value
            };

            // Atualizar IDs locais
            IDS.empresas = configsParaSalvar['id_empresas'];
            IDS.clientes = configsParaSalvar['id_clientes'];
            IDS.itens = configsParaSalvar['id_itens'];
            IDS.orcamentos = configsParaSalvar['id_orcamentos'];
            IDS.configuracoes = configsParaSalvar['id_configuracoes'];

            // Salvar no localStorage
            localStorage.setItem('orcamento_pro_ids', JSON.stringify(IDS));

            // Salvar configura√ß√µes no Baserow
            if (IDS.configuracoes) {
                try {
                    showLoading("Salvando configura√ß√µes...");

                    // Primeiro, limpar configura√ß√µes existentes
                    const existingConfigs = await apiBaserow('GET', IDS.configuracoes, null, null, { size: 100 });
                    if (existingConfigs && existingConfigs.results) {
                        for (const config of existingConfigs.results) {
                            await apiBaserow('DELETE', IDS.configuracoes, null, config.id);
                        }
                    }

                    // Salvar novas configura√ß√µes
                    for (const [chave, valor] of Object.entries(configsParaSalvar)) {
                        if (valor !== undefined && valor !== null && valor !== '') {
                            await apiBaserow('POST', IDS.configuracoes, {
                                chave: chave,
                                valor: valor.toString(),
                                tipo: typeof valor === 'number' ? 'numero' : 'texto'
                            });
                        }
                    }

                    // Atualizar estado
                    estado.configuracoes = configsParaSalvar;

                    // Aplicar configura√ß√µes
                    aplicarConfiguracoes();

                    // Recarregar dados
                    await sincronizarTudo();

                    showSuccess("‚úÖ CONFIGURA√á√ïES SALVAS COM SUCESSO!");
                    fecharConfigModal();
                    hideLoading();

                } catch (error) {
                    console.error('Erro ao salvar configura√ß√µes:', error);
                    showError(`Erro ao salvar configura√ß√µes: ${error.message}`);
                    hideLoading();
                }
            } else {
                showError("ID da tabela de configura√ß√µes n√£o definido!");
            }
        }

        async function testarConexaoBaserow() {
            try {
                showLoading("Testando conex√£o com Baserow...");

                // Testar cada tabela
                const testes = await Promise.allSettled([
                    apiBaserow('GET', IDS.empresas, null, null, { size: 1 }),
                    apiBaserow('GET', IDS.clientes, null, null, { size: 1 }),
                    apiBaserow('GET', IDS.itens, null, null, { size: 1 }),
                    apiBaserow('GET', IDS.orcamentos, null, null, { size: 1 })
                ]);

                const resultados = testes.map((t, i) => ({
                    tabela: ['Empresas', 'Clientes', 'Itens', 'Or√ßamentos'][i],
                    status: t.status,
                    valor: t.status === 'fulfilled' && t.value ? 'OK' : 'ERRO'
                }));

                const todasOk = resultados.every(r => r.status === 'fulfilled');

                if (todasOk) {
                    showSuccess("‚úÖ Conex√£o com Baserow estabelecida com sucesso!");
                } else {
                    const erros = resultados.filter(r => r.status === 'rejected').map(r => r.tabela);
                    showError(`Erro nas tabelas: ${erros.join(', ')}`);
                }

                hideLoading();

            } catch (error) {
                showError(`Erro no teste de conex√£o: ${error.message}`);
                hideLoading();
            }
        }

        async function testarConfigEmail() {
            const host = document.getElementById('config-smtp-host').value;
            const port = document.getElementById('config-smtp-port').value;
            const user = document.getElementById('config-smtp-user').value;
            const emailTeste = document.getElementById('config-email-teste').value;

            if (!host || !port || !user || !emailTeste) {
                showError("Preencha todos os campos obrigat√≥rios para testar o email!");
                return;
            }

            // Esta √© uma simula√ß√£o - em produ√ß√£o, voc√™ faria uma conex√£o real SMTP
            showLoading("Testando configura√ß√µes de email...");

            await new Promise(resolve => setTimeout(resolve, 1500));

            showSuccess("Configura√ß√µes de email testadas com sucesso!\n\n" +
                "Em produ√ß√£o, esta fun√ß√£o faria uma conex√£o real com o servidor SMTP.");

            hideLoading();
        }

        // ============================================
        // FUN√á√ïES DE CALCULADORA AVAN√áADA
        // ============================================
        function calcInput(v) {
            const display = document.getElementById('calc-display');
            display.value += v;
            display.scrollLeft = display.scrollWidth;
        }

        function calcClear() {
            document.getElementById('calc-display').value = '';
            document.getElementById('calc-history').textContent = '';
        }

        function calcClearEntry() {
            document.getElementById('calc-display').value = '';
        }

        function calcBackspace() {
            const display = document.getElementById('calc-display');
            display.value = display.value.slice(0, -1);
        }

        function calcResult() {
            try {
                const display = document.getElementById('calc-display');
                const expressao = display.value
                    .replace(/√ó/g, '*')
                    .replace(/√∑/g, '/')
                    .replace(/\,/g, '.');

                // Seguran√ßa: evitar eval de c√≥digo malicioso
                if (!/^[0-9+\-*/().\s]+$/.test(expressao)) {
                    throw new Error('Express√£o inv√°lida');
                }

                const resultado = eval(expressao);
                const resultadoFormatado = parseFloat(resultado.toFixed(10)).toString();

                // Salvar no hist√≥rico
                historicoCalculadora.push({
                    expressao: display.value,
                    resultado: resultadoFormatado,
                    data: new Date().toLocaleTimeString()
                });

                if (historicoCalculadora.length > 5) {
                    historicoCalculadora.shift();
                }

                document.getElementById('calc-history').textContent = `${display.value} =`;
                display.value = resultadoFormatado;

            } catch (error) {
                document.getElementById('calc-display').value = 'Erro';
                setTimeout(() => {
                    document.getElementById('calc-display').value = '';
                }, 1500);
            }
        }

        function calcPercentage() {
            try {
                const display = document.getElementById('calc-display');
                const valorAtual = parseFloat(display.value) || 0;
                display.value = (valorAtual / 100).toString();
            } catch (e) {
                document.getElementById('calc-display').value = 'Erro';
            }
        }

        function calcMemorySave() {
            try {
                const display = document.getElementById('calc-display');
                const valor = parseFloat(display.value) || 0;
                memoriaCalculadora = valor;
                document.getElementById('memory-indicator').classList.remove('hidden');
                showSuccess(`Valor ${valor} salvo na mem√≥ria (M)`);
            } catch (e) {
                showError("Erro ao salvar na mem√≥ria");
            }
        }

        function calcMemoryRecall() {
            document.getElementById('calc-display').value = memoriaCalculadora.toString();
        }

        function calcMemoryClear() {
            memoriaCalculadora = 0;
            document.getElementById('memory-indicator').classList.add('hidden');
            showSuccess("Mem√≥ria limpa");
        }

        function copiarResultadoCalc() {
            const display = document.getElementById('calc-display');
            if (display.value) {
                navigator.clipboard.writeText(display.value)
                    .then(() => showSuccess("Resultado copiado para a √°rea de transfer√™ncia!"))
                    .catch(() => showError("Erro ao copiar"));
            }
        }

        function inserirNaDescricao() {
            const valor = document.getElementById('calc-display').value;
            const itens = document.querySelectorAll('.item-row');

            if (itens.length > 0) {
                const ultimoItem = itens[itens.length - 1];
                const descInput = ultimoItem.querySelector('.desc');
                if (descInput) {
                    descInput.value += ` ${valor}`;
                    descInput.focus();
                    showSuccess("Valor inserido na descri√ß√£o!");
                }
            } else {
                showError("Adicione um item primeiro");
            }
        }

        function toggleCalcMode() {
            modoCalculadora = modoCalculadora === 'basico' ? 'cientifica' : 'basico';
            const btn = document.getElementById('calc-mode-btn');

            if (modoCalculadora === 'cientifica') {
                btn.innerHTML = '<i class="fas fa-superscript"></i>';
                btn.title = "Modo Cient√≠fico";
                showSuccess("Modo Cient√≠fico ativado");
            } else {
                btn.innerHTML = '<i class="fas fa-calculator"></i>';
                btn.title = "Modo B√°sico";
                showSuccess("Modo B√°sico ativado");
            }
        }

        // ============================================
        // FUN√á√ïES DE IMPORTA√á√ÉO (OCR/PDF)
        // ============================================
        function abrirImportModal() {
            document.getElementById('import-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';

            // Configurar eventos dos inputs
            document.getElementById('pdf-file').onchange = function (e) {
                processarPDFTexto(e.target.files[0]);
            };

            document.getElementById('ocr-file').onchange = function (e) {
                processarOCR(e.target.files[0]);
            };
        }

        function fecharImportModal() {
            document.getElementById('import-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            limparPreview();
        }

        async function processarPDFTexto(file) {
            if (!file) return;

            showLoading("üìÑ Analisando PDF...");

            try {
                const arrayBuffer = await file.arrayBuffer();
                const typedArray = new Uint8Array(arrayBuffer);

                const pdf = await pdfjsLib.getDocument(typedArray).promise;
                let fullText = "";

                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    fullText += content.items.map(item => item.str).join(" ") + "\n";
                }

                document.getElementById('pdf-preview').innerHTML =
                    `<div class="text-green-400 mb-2">‚úì PDF carregado com ${pdf.numPages} p√°gina(s)</div>
                     <div class="text-xs max-h-40 overflow-y-auto">${fullText.substring(0, 1000)}...</div>`;
                document.getElementById('pdf-preview').classList.remove('hidden');

                extrairItensDoTexto(fullText);
                hideLoading();

            } catch (error) {
                showError(`Erro ao processar PDF: ${error.message}`);
                hideLoading();
            }
        }

        async function processarOCR(file) {
            if (!file) return;

            showLoading("üîç Processando OCR...");

            try {
                const imageUrl = URL.createObjectURL(file);
                const worker = await Tesseract.createWorker('por');

                await worker.setParameters({
                    tessedit_pageseg_mode: Tesseract.PSM.AUTO,
                    tessedit_char_whitelist: '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.,$R$()-/ ',
                    preserve_interword_spaces: '1'
                });

                const { data: { text } } = await worker.recognize(imageUrl);
                await worker.terminate();
                URL.revokeObjectURL(imageUrl);

                document.getElementById('ocr-preview').innerHTML =
                    `<div class="text-green-400 mb-2">‚úì OCR conclu√≠do</div>
                     <div class="text-xs max-h-40 overflow-y-auto">${text.substring(0, 1000)}...</div>`;
                document.getElementById('ocr-preview').classList.remove('hidden');

                extrairItensDoTexto(text);
                hideLoading();

            } catch (error) {
                showError(`Erro no OCR: ${error.message}`);
                if (file.type === 'application/pdf') {
                    processarPDFTexto(file);
                }
                hideLoading();
            }
        }

        function extrairItensDoTexto(texto) {
            itensImportados = [];
            const padroes = [
                /([A-Za-z√Ä-√ø0-9\s\.\/\-\"\(\)]+)\s+(UND|UN|P√á|PC|MT|KG|CX|GL|LT)\s+([\d\.,]+)\s+([\d\.,]+)/gi,
                /(\d+)\s*x\s+([A-Za-z√Ä-√ø0-9\s\.\/\-\"\(\)]+?)\s+[-‚Äì]\s+R\$\s*([\d\.,]+)/gi,
                /\d+\s*\|\s*([A-Za-z√Ä-√ø0-9\s\.\/\-\"\(\)]+?)\s*\|\s*(UND|UN|P√á|PC|MT|KG|CX|GL|LT)\s*\|\s*([\d\.,]+)\s*\|\s*([\d\.,]+)/gi,
                /([A-Za-z√Ä-√ø0-9\s\.\/\-\"\(\)]+)\s+R\$\s*([\d\.,]+)\s+(\d+)/gi
            ];

            let encontrados = [];

            for (const padrao of padroes) {
                let match;
                while ((match = padrao.exec(texto)) !== null) {
                    let descricao, unidade, quantidade, valor;

                    if (match.length >= 4) {
                        if (padrao.toString().includes('x')) {
                            quantidade = match[1];
                            descricao = match[2];
                            valor = match[3];
                            unidade = 'UN';
                        } else if (padrao.toString().includes('R$')) {
                            descricao = match[1];
                            valor = match[2];
                            quantidade = match[3] || '1';
                            unidade = 'UN';
                        } else {
                            descricao = match[1];
                            unidade = match[2];
                            quantidade = match[3];
                            valor = match[4];
                        }

                        descricao = descricao.trim().replace(/\s+/g, ' ');
                        unidade = (unidade || 'UN').toUpperCase();
                        quantidade = parseFloat(quantidade.toString().replace(/\./g, '').replace(',', '.'));
                        valor = parseFloat(valor.toString().replace(/\./g, '').replace(',', '.'));

                        if (!isNaN(quantidade) && !isNaN(valor) && descricao.length > 3) {
                            encontrados.push({
                                descricao: descricao,
                                unidade: unidade,
                                quantidade: quantidade,
                                valor: valor,
                                total: quantidade * valor
                            });
                        }
                    }
                }
            }

            encontrados = encontrados.filter((item, index, self) =>
                index === self.findIndex((t) => (
                    t.descricao === item.descricao &&
                    t.valor === item.valor
                ))
            );

            encontrados.sort((a, b) => b.total - a.total);
            itensImportados = encontrados.slice(0, 50);
            atualizarPreviewItens();

            if (itensImportados.length > 0) {
                showSuccess(`‚úÖ ${itensImportados.length} itens detectados!`);
            } else {
                showError("Nenhum item detectado automaticamente. Tente o modo manual.");
            }
        }

        function atualizarPreviewItens() {
            const tbody = document.getElementById('itens-preview-body');
            tbody.innerHTML = '';

            itensImportados.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-800/50';
                tr.innerHTML = `
                    <td class="py-2">
                        <select class="w-full bg-slate-900 border border-slate-700 rounded px-2 py-1 text-xs" 
                                onchange="atualizarItemImportado(${index}, 'unidade', this.value)">
                            <option value="UN" ${item.unidade === 'UN' ? 'selected' : ''}>UN</option>
                            <option value="P√á" ${item.unidade === 'P√á' ? 'selected' : ''}>P√á</option>
                            <option value="MT" ${item.unidade === 'MT' ? 'selected' : ''}>MT</option>
                            <option value="KG" ${item.unidade === 'KG' ? 'selected' : ''}>KG</option>
                            <option value="CX" ${item.unidade === 'CX' ? 'selected' : ''}>CX</option>
                            <option value="GL" ${item.unidade === 'GL' ? 'selected' : ''}>GL</option>
                            <option value="L" ${item.unidade === 'L' ? 'selected' : ''}>L</option>
                        </select>
                    </td>
                    <td class="py-2 text-center">
                        <input type="number" value="${item.quantidade}" step="0.01" 
                               class="qtd w-full bg-slate-900 border border-slate-700 rounded px-2 py-1 text-center text-xs"
                               onchange="atualizarItemImportado(${index}, 'quantidade', this.value)">
                    </td>
                    <td class="py-2 text-xs">${item.descricao}</td>
                    <td class="py-2 text-right">
                        <input type="number" value="${item.valor.toFixed(2)}" step="0.01"
                               class="w-full bg-slate-900 border border-slate-700 rounded px-2 py-1 text-right text-xs"
                               onchange="atualizarItemImportado(${index}, 'valor', this.value)">
                    </td>
                    <td class="py-2 text-center">
                        <button onclick="importarItemIndividual(${index})" class="text-emerald-400 text-xs font-bold hover:text-emerald-300 px-2">
                            <i class="fas fa-plus"></i>
                        button>
                        <button onclick="removerItemImportado(${index})" class="text-red-400 text-xs font-bold hover:text-red-300 px-2">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function atualizarItemImportado(index, campo, valor) {
            if (campo === 'quantidade' || campo === 'valor') {
                valor = parseFloat(valor) || 0;
            }
            itensImportados[index][campo] = valor;

            if (campo === 'quantidade' || campo === 'valor') {
                itensImportados[index].total = itensImportados[index].quantidade * itensImportados[index].valor;
            }
        }

        function removerItemImportado(index) {
            itensImportados.splice(index, 1);
            atualizarPreviewItens();
        }

        function importarItemIndividual(index) {
            const item = itensImportados[index];
            addItem();
            const rows = document.querySelectorAll('.item-row');
            const lastRow = rows[rows.length - 1];
            lastRow.querySelector('.un').value = item.unidade;
            lastRow.querySelector('.qtd').value = item.quantidade;
            lastRow.querySelector('.desc').value = item.descricao;
            lastRow.querySelector('.val').value = item.valor;
            calcularItem(lastRow.querySelector('.desc'));
            showSuccess("‚úÖ Item importado!");
        }

        function importarParaOrcamento() {
            if (itensImportados.length === 0) {
                showError("Nenhum item para importar!");
                return;
            }

            // Limpar itens atuais
            const rows = document.querySelectorAll('.item-row');
            rows.forEach(row => row.remove());

            // Adicionar todos os itens importados
            itensImportados.forEach(item => {
                addItem();
                const rows = document.querySelectorAll('.item-row');
                const lastRow = rows[rows.length - 1];
                lastRow.querySelector('.un').value = item.unidade;
                lastRow.querySelector('.qtd').value = item.quantidade;
                lastRow.querySelector('.desc').value = item.descricao;
                lastRow.querySelector('.val').value = item.valor;
                calcularItem(lastRow.querySelector('.desc'));
            });

            calcularTotalOrcamento();
            atualizarEstatisticasQuantidade();
            showSuccess(`‚úÖ ${itensImportados.length} itens importados com sucesso!`);
            fecharImportModal();
        }

        function limparPreview() {
            itensImportados = [];
            document.getElementById('itens-preview-body').innerHTML = '';
            document.getElementById('pdf-preview').innerHTML = '';
            document.getElementById('pdf-preview').classList.add('hidden');
            document.getElementById('ocr-preview').innerHTML = '';
            document.getElementById('ocr-preview').classList.add('hidden');
        }

        // ============================================
        // FUN√á√ïES AUXILIARES DA INTERFACE
        // ============================================
        function switchTab(tab) {
            // Esconder todas as abas
            document.querySelectorAll('section, main').forEach(el => {
                el.classList.add('hidden');
            });

            // Remover classe ativa de todos os bot√µes
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('tab-active', 'bg-slate-800', 'text-cyan-400');
            });

            // Mostrar aba selecionada
            const tabElement = document.getElementById(`tab-${tab}`);
            if (tabElement) {
                tabElement.classList.remove('hidden');
                tabElement.classList.add('fade-in');

                // Ativar bot√£o selecionado
                const btnElement = document.getElementById(`btn-${tab}`);
                if (btnElement) {
                    btnElement.classList.add('tab-active', 'bg-slate-800', 'text-cyan-400');
                }
            }
        }

        function toggleCalc() {
            const calc = document.getElementById('calc-container');
            if (calc.style.display === 'block' || calc.style.display === '') {
                calc.style.display = 'none';
            } else {
                calc.style.display = 'block';
                // Focar no display da calculadora
                document.getElementById('calc-display').focus();
            }
        }

        function atualizarSelects() {
            // Select de empresas
            const selectEmpresa = document.getElementById('sel-empresa');
            selectEmpresa.innerHTML = '<option value="">Selecione uma empresa</option>' +
                estado.empresas.map(e =>
                    `<option value="${e.id}">${e.nome}${e.cnpj ? ` - ${formatarCNPJ(e.cnpj)}` : ''}</option>`
                ).join('');

            // Select de clientes
            const selectCliente = document.getElementById('sel-cliente');
            selectCliente.innerHTML = '<option value="">Selecione um cliente</option>' +
                estado.clientes.map(c =>
                    `<option value="${c.id}">${c.nome}${c.documento ? ` - ${c.tipo === 'Jur√≠dica' ? formatarCNPJ(c.documento) : formatarCPF(c.documento)}` : ''}</option>`
                ).join('');

            // Filtro de empresa no hist√≥rico
            const filtroEmpresa = document.getElementById('filtro-empresa');
            const empresasUnicas = [...new Set(estado.orcamentos.map(o => o.empresa).filter(Boolean))];
            filtroEmpresa.innerHTML = '<option value="">Todas</option>' +
                empresasUnicas.map(e => `<option value="${e}">${e}</option>`).join('');

            // Filtro de cliente no hist√≥rico
            const filtroCliente = document.getElementById('filtro-cliente');
            const clientesUnicos = [...new Set(estado.orcamentos.map(o => o.cliente).filter(Boolean))];
            filtroCliente.innerHTML = '<option value="">Todos</option>' +
                clientesUnicos.map(c => `<option value="${c}">${c}</option>`).join('');

            // Filtro de categorias de itens
            const filtroCategoria = document.getElementById('filter-item-categoria');
            const categoriasUnicas = [...new Set(estado.itens.map(i => i.categoria).filter(Boolean))];
            filtroCategoria.innerHTML = '<option value="">Todas categorias</option>' +
                categoriasUnicas.map(c => `<option value="${c}">${c}</option>`).join('');

            // Atualizar informa√ß√µes da empresa e cliente selecionados
            const empresaId = selectEmpresa.value;
            const clienteId = selectCliente.value;

            if (empresaId) {
                const empresa = estado.empresas.find(e => e.id == empresaId);
                if (empresa) {
                    document.getElementById('empresa-info').innerHTML = `
                        ${empresa.cnpj ? `CNPJ: ${formatarCNPJ(empresa.cnpj)}` : ''}<br>
                        ${empresa.cidade ? `${empresa.cidade}/${empresa.uf}` : ''}
                    `;
                }
            } else {
                document.getElementById('empresa-info').innerHTML = '';
            }

            if (clienteId) {
                const cliente = estado.clientes.find(c => c.id == clienteId);
                if (cliente) {
                    document.getElementById('cliente-info').innerHTML = `
                        ${cliente.documento ? `Doc: ${cliente.tipo === 'Jur√≠dica' ? formatarCNPJ(cliente.documento) : formatarCPF(cliente.documento)}` : ''}<br>
                        ${cliente.email || ''}
                    `;
                }
            } else {
                document.getElementById('cliente-info').innerHTML = '';
            }
        }

        function renderClientes(clientesFiltrados = null) {
            const clientes = clientesFiltrados || estado.clientes;
            const tbody = document.getElementById('lista-clientes-body');

            if (clientes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="p-8 text-center text-slate-500">
                            <i class="fas fa-users text-2xl mb-2"></i><br>
                            Nenhum cliente cadastrado.
                        </td>
                    </tr>`;
                return;
            }

            tbody.innerHTML = clientes.map(cliente => {
                const documentoFormatado = cliente.tipo === 'Jur√≠dica' ?
                    formatarCNPJ(cliente.documento) : formatarCPF(cliente.documento);

                return `
                    <tr class="border-b border-slate-800/50 hover:bg-slate-800/30 transition">
                        <td class="p-4">
                            <div class="font-bold text-sm">${cliente.nome}</div>
                            <div class="text-xs text-slate-400">${cliente.contato || '--'}</div>
                            <div class="text-[10px] text-cyan-600 mt-1">
                                <span class="px-2 py-0.5 rounded bg-cyan-900/30">${cliente.tipo || 'F√≠sica'}</span>
                            </div>
                        </td>
                        <td class="p-4 text-sm">${documentoFormatado || '--'}</td>
                        <td class="p-4 text-sm">
                            <div>${cliente.email || '--'}</div>
                            <div class="text-xs text-slate-400">${cliente.telefone || '--'}</div>
                        </td>
                        <td class="p-4 text-right">
                            <div class="flex gap-2 justify-end">
                                <button onclick="editarCliente(${cliente.id})" 
                                        class="text-cyan-400 hover:text-cyan-300 text-xs px-3 py-1 rounded bg-slate-800/50 transition"
                                        title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="selecionarClienteParaOrcamento(${cliente.id})" 
                                        class="text-emerald-400 hover:text-emerald-300 text-xs px-3 py-1 rounded bg-slate-800/50 transition"
                                        title="Usar em or√ßamento">
                                    <i class="fas fa-file-invoice"></i>
                                </button>
                                <button onclick="excluirCliente(${cliente.id})" 
                                        class="text-red-500 hover:text-red-400 text-xs px-3 py-1 rounded bg-slate-800/50 transition"
                                        title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>`;
            }).join('');
        }

        function selecionarClienteParaOrcamento(id) {
            const cliente = estado.clientes.find(c => c.id == id);
            if (cliente) {
                document.getElementById('sel-cliente').value = cliente.id;
                atualizarSelects();
                switchTab('orcamento');
                showSuccess(`Cliente ${cliente.nome} selecionado!`);
            }
        }

        function renderEmpresas() {
            const container = document.getElementById('grid-empresas');

            if (estado.empresas.length === 0) {
                container.innerHTML = `
                    <div class="col-span-3 text-center p-8 text-slate-500">
                        <i class="fas fa-building text-3xl mb-2"></i><br>
                        Nenhuma empresa cadastrada.
                    </div>`;
                return;
            }

            container.innerHTML = estado.empresas.map(empresa => {
                const cnpjFormatado = formatarCNPJ(empresa.CNPJ);

                return `
                    <div class="futuristic-card p-6 flex flex-col hover:border-cyan-500/30 transition">
                        <div class="flex items-center gap-3 mb-4">
                            ${empresa.logo ?
                        `<img src="${empresa.logo}" class="h-12 w-12 object-contain rounded-lg bg-slate-900 p-2 border border-slate-700">` :
                        `<div class="h-12 w-12 bg-cyan-900/30 rounded-lg flex items-center justify-center border border-slate-700">
                                    <i class="fas fa-building text-lg text-cyan-400"></i>
                                </div>`}
                            <div class="flex-1">
                                <p class="font-bold text-sm truncate">${empresa.nome}</p>
                                <p class="text-xs text-slate-400 truncate">${empresa.razao_social || ''}</p>
                                <p class="text-[10px] text-cyan-600 mt-1">${cnpjFormatado || ''}</p>
                            </div>
                        </div>
                        <div class="mt-auto flex justify-between items-center">
                            <button onclick="selecionarEmpresaParaOrcamento(${empresa.id})" 
                                    class="text-emerald-400 hover:text-emerald-300 text-[10px] font-bold px-3 py-1 rounded bg-slate-800/50 transition">
                                <i class="fas fa-file-invoice mr-1"></i> Usar
                            </button>
                            <div class="flex gap-1">
                                <button onclick="editarEmpresa(${empresa.id})" 
                                        class="text-cyan-400 hover:text-cyan-300 text-[10px] px-2 py-1 rounded bg-slate-800/50 transition">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="excluirEmpresa(${empresa.id})" 
                                        class="text-red-500 hover:text-red-400 text-[10px] px-2 py-1 rounded bg-slate-800/50 transition">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>`;
            }).join('');
        }

        function selecionarEmpresaParaOrcamento(id) {
            const empresa = estado.empresas.find(e => e.id == id);
            if (empresa) {
                document.getElementById('sel-empresa').value = empresa.id;
                atualizarSelects();
                switchTab('orcamento');
                showSuccess(`Empresa ${empresa.nome} selecionada!`);
            }
        }

        function renderItens(itensFiltrados = null) {
            const itens = itensFiltrados || estado.itens;
            const tbody = document.getElementById('lista-itens-body');

            if (itens.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="p-8 text-center text-slate-500">
                            <i class="fas fa-boxes text-2xl mb-2"></i><br>
                            Nenhum item cadastrado.
                        </td>
                    </tr>`;
                return;
            }

            tbody.innerHTML = itens.map(item => {
                const valor = parseFloat(item.valor_unitario || 0);
                const estoqueAtual = parseInt(item.estoque_atual || 0);
                const estoqueMinimo = parseInt(item.estoque_m√≠nimo || 0);
                const estoqueClasse = estoqueAtual <= estoqueMinimo ? 'text-red-400' :
                    estoqueAtual <= estoqueMinimo * 2 ? 'text-amber-400' : 'text-emerald-400';

                return `
                    <tr class="border-b border-slate-800/50 hover:bg-slate-800/30 transition">
                        <td class="p-4">
                            <div class="font-mono text-sm font-bold">${item.c√≥digo || '--'}</div>
                        </td>
                        <td class="p-4">
                            <div class="font-bold text-sm">${item.nome}</div>
                            <div class="text-xs text-slate-400 truncate max-w-[200px]">${item.descricao?.substring(0, 50) || ''}</div>
                        </td>
                        <td class="p-4 text-sm">${item.categoria || '--'}</td>
                        <td class="p-4 text-center font-mono">${item.unidade_medida || 'UN'}</td>
                        <td class="p-4 text-right font-bold text-emerald-400">
                            R$ ${valor.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                        </td>
                        <td class="p-4 text-center">
                            <span class="px-2 py-1 rounded text-xs font-bold ${estoqueClasse} bg-slate-800/50">
                                ${estoqueAtual} ${estoqueAtual <= estoqueMinimo ? '‚ö†Ô∏è' : ''}
                            </span>
                        </td>
                        <td class="p-4 text-right">
                            <div class="flex gap-2 justify-end">
                                <button onclick="editarItem(${item.id})" 
                                        class="text-cyan-400 hover:text-cyan-300 text-xs px-3 py-1 rounded bg-slate-800/50 transition"
                                        title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="adicionarItemAoOrcamento(${item.id})" 
                                        class="text-emerald-400 hover:text-emerald-300 text-xs px-3 py-1 rounded bg-slate-800/50 transition"
                                        title="Adicionar ao or√ßamento">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button onclick="excluirItem(${item.id})" 
                                        class="text-red-500 hover:text-red-400 text-xs px-3 py-1 rounded bg-slate-800/50 transition"
                                        title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>`;
            }).join('');
        }

        function adicionarItemAoOrcamento(id) {
            const item = estado.itens.find(i => i.id == id);
            if (!item) return;

            // Mudar para aba de or√ßamento
            switchTab('orcamento');

            // Adicionar item
            addItem();
            const rows = document.querySelectorAll('.item-row');
            const lastRow = rows[rows.length - 1];
            lastRow.querySelector('.un').value = item.unidade_medida || 'UN';
            lastRow.querySelector('.qtd').value = 1;
            lastRow.querySelector('.desc').value = item.nome;
            lastRow.querySelector('.val').value = item.valor_unitario || 0;
            calcularItem(lastRow.querySelector('.desc'));

            showSuccess(`Item "${item.nome}" adicionado ao or√ßamento!`);
        }

        function buscarOrcamento(v) {
            const resultados = document.getElementById('search-results');
            if (!v || v.length < 2) {
                resultados.classList.add('hidden');
                return;
            }

            const termo = v.toLowerCase();
            const encontrados = estado.orcamentos.filter(o =>
                (o.cliente && o.cliente.toLowerCase().includes(termo)) ||
                (o.numero && o.numero.toLowerCase().includes(termo)) ||
                (o.empresa && o.empresa.toLowerCase().includes(termo))
            ).slice(0, 10);

            if (encontrados.length === 0) {
                resultados.innerHTML = '<div class="search-item text-slate-500 p-4">Nenhum resultado encontrado</div>';
                resultados.classList.remove('hidden');
                return;
            }

            resultados.innerHTML = encontrados.map(o => {
                const dataFormatada = formatarDataParaExibicao(o.data);
                return `
                    <div class="search-item" onclick="carregarOrcamentoParaEdicao(${o.id})">
                        <div class="font-bold text-cyan-400">${o.numero}</div>
                        <div class="text-sm">${o.cliente}</div>
                        <div class="text-xs text-slate-400">
                            ${dataFormatada} ‚Ä¢ R$ ${parseFloat(o.total || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                        </div>
                    </div>`;
            }).join('');

            resultados.classList.remove('hidden');
        }

        function limparTelaOrcamento() {
            // Limpar sele√ß√µes
            document.getElementById('sel-empresa').value = '';
            document.getElementById('sel-cliente').value = '';

            // Limpar dados
            document.getElementById('orcamento-data').value = '';
            document.getElementById('orcamento-validade').value = '';
            document.getElementById('orcamento-numero').value = '';
            document.getElementById('cond-pagamento').value = '√Ä Vista - Dinheiro/PIX';
            document.getElementById('cond-entrega').value = 'Imediato';
            document.getElementById('cond-especiais').value = '';
            document.getElementById('orcamento-observacoes').value = '';

            document.getElementById('desconto-percentual').value = 0;
            document.getElementById('acrescimo-percentual').value = 0;

            // Limpar itens
            const rows = document.querySelectorAll('.item-row');
            rows.forEach(row => row.remove());

            // Limpar busca
            document.getElementById('search-orcamento').value = '';
            document.getElementById('search-results').classList.add('hidden');

            // Adicionar um item inicial
            addItem();

            // Calcular total e estat√≠sticas
            calcularTotalOrcamento();
            atualizarEstatisticasQuantidade();

            // Desabilitar bot√£o de email
            document.getElementById('btn-enviar-email').disabled = true;

            // Limpar or√ßamento em edi√ß√£o
            estado.orcamentoEditando = null;

            // Configurar datas padr√£o
            configurarDatasPadrao();

            // Atualizar selects
            atualizarSelects();

            // Resetar status
            document.getElementById('status-orcamento').textContent = 'Pendente';

            showSuccess("Tela de or√ßamento limpa!");
        }

        // ============================================
        // FUN√á√ïES DE UTILIDADE
        // ============================================
        function updateClock() {
            const now = getDataHoraAtual();

            // Formatar data para exibi√ß√£o
            const dia = String(now.getDate()).padStart(2, '0');
            const mes = String(now.getMonth() + 1).padStart(2, '0');
            const ano = now.getFullYear();
            document.getElementById('widget-date').innerText = `${dia}/${mes}/${ano}`;

            // Formatar hora para exibi√ß√£o
            const hora = String(now.getHours()).padStart(2, '0');
            const minuto = String(now.getMinutes()).padStart(2, '0');
            const segundo = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('widget-time').innerText = `${hora}:${minuto}:${segundo}`;
        }

        function showSuccess(msg) {
            const toast = document.getElementById('success-toast');
            document.getElementById('toast-message').innerText = msg;

            toast.classList.remove('hidden');
            toast.classList.add('animate-bounce');

            setTimeout(() => {
                toast.classList.add('hidden');
                toast.classList.remove('animate-bounce');
            }, 3000);
        }

        function showError(msg) {
            const toast = document.getElementById('error-toast');
            document.getElementById('error-message').innerText = msg;

            toast.classList.remove('hidden');
            toast.classList.add('animate-bounce');

            setTimeout(() => {
                toast.classList.add('hidden');
                toast.classList.remove('animate-bounce');
            }, 4000);
        }

        function showLoading(msg) {
            // Criar ou atualizar overlay de loading
            let loadingOverlay = document.getElementById('loading-overlay');
            if (!loadingOverlay) {
                loadingOverlay = document.createElement('div');
                loadingOverlay.id = 'loading-overlay';
                loadingOverlay.className = 'fixed inset-0 bg-black/70 flex items-center justify-center z-[1000]';
                loadingOverlay.innerHTML = `
                    <div class="bg-slate-800 p-8 rounded-2xl border border-cyan-500/30 flex flex-col items-center">
                        <div class="spinner mb-4"></div>
                        <div class="text-cyan-400 font-bold" id="loading-message">${msg}</div>
                    </div>
                `;
                document.body.appendChild(loadingOverlay);
            } else {
                document.getElementById('loading-message').textContent = msg;
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ============================================
        // FUN√á√ïES DE M√ÅSCARAS
        // ============================================
        function maskDoc(input) {
            let value = input.value.replace(/\D/g, '');

            if (value.length <= 11) {
                // CPF
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            } else {
                // CNPJ
                value = value.substring(0, 14);
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
            }

            input.value = value;
        }

        function maskCNPJ(input) {
            let value = input.value.replace(/\D/g, '');
            value = value.substring(0, 14);

            value = value.replace(/^(\d{2})(\d)/, '$1.$2');
            value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
            value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
            value = value.replace(/(\d{4})(\d)/, '$1-$2');

            input.value = value;
        }

        // ============================================
        // MANIPULA√á√ÉO DO TECLADO
        // ============================================
        document.addEventListener('keydown', function (event) {
            const calcDisplay = document.getElementById('calc-display');
            const calcVisible = document.getElementById('calc-container').style.display === 'block';

            // Se a calculadora est√° vis√≠vel, capturar teclas
            if (calcVisible && document.activeElement !== calcDisplay) {
                // N√∫meros
                if (event.key >= '0' && event.key <= '9') {
                    calcInput(event.key);
                    event.preventDefault();
                }
                // Operadores
                else if (['+', '-', '*', '/'].includes(event.key)) {
                    calcInput(event.key === '*' ? '√ó' : event.key);
                    event.preventDefault();
                }
                // Ponto decimal
                else if (event.key === '.' || event.key === ',') {
                    calcInput('.');
                    event.preventDefault();
                }
                // Par√™nteses
                else if (event.key === '(') {
                    calcInput('(');
                    event.preventDefault();
                }
                else if (event.key === ')') {
                    calcInput(')');
                    event.preventDefault();
                }
                // Enter para calcular
                else if (event.key === 'Enter') {
                    calcResult();
                    event.preventDefault();
                }
                // Backspace
                else if (event.key === 'Backspace') {
                    calcBackspace();
                    event.preventDefault();
                }
                // Escape para limpar
                else if (event.key === 'Escape') {
                    calcClear();
                    event.preventDefault();
                }
                // Tecla C para limpar entrada
                else if (event.key === 'c' || event.key === 'C') {
                    if (event.ctrlKey) {
                        calcClear();
                        event.preventDefault();
                    }
                }
            }

            // Atalho global para abrir/fechar calculadora (Ctrl+Shift+C)
            if (event.ctrlKey && event.shiftKey && event.key === 'C') {
                toggleCalc();
                event.preventDefault();
            }

            // Atalho para buscar or√ßamento (Ctrl+F)
            if (event.ctrlKey && event.key === 'f') {
                document.getElementById('search-orcamento').focus();
                event.preventDefault();
            }

            // Atalho para novo or√ßamento (Ctrl+N)
            if (event.ctrlKey && event.key === 'n') {
                limparTelaOrcamento();
                event.preventDefault();
            }

            // Atalho para salvar (Ctrl+S)
            if (event.ctrlKey && event.key === 's') {
                salvarOrcamento();
                event.preventDefault();
            }

            // Atalho para gerar PDF (Ctrl+P)
            if (event.ctrlKey && event.key === 'p') {
                gerarPDF(false);
                event.preventDefault();
            }
        });

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        window.onload = async () => {
            // Carregar IDs do localStorage se existirem
            const idsSalvos = localStorage.getItem('orcamento_pro_ids');
            if (idsSalvos) {
                try {
                    Object.assign(IDS, JSON.parse(idsSalvos));
                } catch (e) {
                    console.error('Erro ao carregar IDs:', e);
                }
            }

            // Inicializar interface
            updateClock();
            setInterval(updateClock, 1000);

            // Carregar tema salvo
            loadTheme();

            // Configurar bot√£o de tema
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

            // Adicionar item inicial
            addItem();

            // Sincronizar dados
            await sincronizarTudo();

            // Configurar evento para fechar resultados de busca ao clicar fora
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#search-orcamento') && !e.target.closest('#search-results')) {
                    document.getElementById('search-results').classList.add('hidden');
                }

                // Fechar sugest√µes de cat√°logo
                document.querySelectorAll('.catalogo-sugestoes').forEach(el => {
                    if (!e.target.closest('.desc')) {
                        el.classList.add('hidden');
                    }
                });
            });

            showSuccess("Sistema Or√ßamento Pro V5.1 carregado com sucesso!");
        };

        // ============================================
        // EXPORTAR FUN√á√ïES PARA O ESCOPO GLOBAL
        // ============================================
        window.abrirImportModal = abrirImportModal;
        window.fecharImportModal = fecharImportModal;
        window.abrirConfigModal = abrirConfigModal;
        window.fecharConfigModal = fecharConfigModal;
        window.abrirEmailModal = abrirEmailModal;
        window.fecharEmailModal = fecharEmailModal;
        window.enviarEmailConfirmado = enviarEmailConfirmado;
        window.switchTab = switchTab;
        window.toggleCalc = toggleCalc;
        window.calcInput = calcInput;
        window.calcClear = calcClear;
        window.calcResult = calcResult;
        window.calcClearEntry = calcClearEntry;
        window.calcBackspace = calcBackspace;
        window.calcPercentage = calcPercentage;
        window.calcMemorySave = calcMemorySave;
        window.calcMemoryRecall = calcMemoryRecall;
        window.calcMemoryClear = calcMemoryClear;
        window.copiarResultadoCalc = copiarResultadoCalc;
        window.inserirNaDescricao = inserirNaDescricao;
        window.toggleCalcMode = toggleCalcMode;

        window.addItem = addItem;
        window.calcularItem = calcularItem;
        window.calcularTotalOrcamento = calcularTotalOrcamento;
        window.calcularDesconto = calcularDesconto;
        window.calcularAcrescimo = calcularAcrescimo;
        window.atualizarEstatisticasQuantidade = atualizarEstatisticasQuantidade;
        window.salvarOrcamento = salvarOrcamento;
        window.gerarPDF = gerarPDF;
        window.duplicarOrcamento = duplicarOrcamento;
        window.limparTelaOrcamento = limparTelaOrcamento;

        window.salvarCliente = salvarCliente;
        window.editarCliente = editarCliente;
        window.excluirCliente = excluirCliente;
        window.filtrarClientes = filtrarClientes;
        window.limparCliForm = limparCliForm;
        window.selecionarClienteParaOrcamento = selecionarClienteParaOrcamento;

        window.salvarEmpresa = salvarEmpresa;
        window.editarEmpresa = editarEmpresa;
        window.excluirEmpresa = excluirEmpresa;
        window.visualizarLogo = visualizarLogo;
        window.limparEmpForm = limparEmpForm;
        window.selecionarEmpresaParaOrcamento = selecionarEmpresaParaOrcamento;

        window.salvarItem = salvarItem;
        window.editarItem = editarItem;
        window.excluirItem = excluirItem;
        window.filtrarItens = filtrarItens;
        window.limparItemForm = limparItemForm;
        window.adicionarItemAoOrcamento = adicionarItemAoOrcamento;
        window.buscarItensCatalogo = buscarItensCatalogo;

        window.renderRelatorios = renderRelatorios;
        window.carregarOrcamentoParaEdicao = carregarOrcamentoParaEdicao;
        window.alterarStatusOrcamento = alterarStatusOrcamento;
        window.excluirOrcamento = excluirOrcamento;
        window.visualizarPDF = visualizarPDF;
        window.prepararEnvioEmailOrcamento = prepararEnvioEmailOrcamento;
        window.exportarRelatorio = exportarRelatorio;
        window.mudarPaginaRelatorios = mudarPaginaRelatorios;

        window.testarConexaoBaserow = testarConexaoBaserow;
        window.testarConfigEmail = testarConfigEmail;
        window.salvarConfiguracoesAvancadas = salvarConfiguracoesAvancadas;

        window.buscarOrcamento = buscarOrcamento;
        window.atualizarEmailCliente = atualizarEmailCliente;
        window.maskDoc = maskDoc;
        window.maskCNPJ = maskCNPJ;

        // Fun√ß√µes de importa√ß√£o
        window.processarPDFTexto = processarPDFTexto;
        window.processarOCR = processarOCR;
        window.extrairItensDoTexto = extrairItensDoTexto;
        window.atualizarPreviewItens = atualizarPreviewItens;
        window.atualizarItemImportado = atualizarItemImportado;
        window.removerItemImportado = removerItemImportado;
        window.importarItemIndividual = importarItemIndividual;
        window.importarParaOrcamento = importarParaOrcamento;
        window.limparPreview = limparPreview;

        // Fun√ß√µes de tema
        window.toggleTheme = toggleTheme;
        window.loadTheme = loadTheme;

        // Fun√ß√µes de data corrigidas
        window.getDataAtualFormatada = getDataAtualFormatada;
        window.formatarDataParaExibicao = formatarDataParaExibicao;
        window.formatarDataPDF = formatarDataPDF;
        window.adicionarDiasData = adicionarDiasData;
        window.getDataHoraAtual = getDataHoraAtual;
        window.validarData = validarData;

        // Fun√ß√µes de formata√ß√£o
        window.formatarCNPJ = formatarCNPJ;
        window.formatarCPF = formatarCPF;

    </script>
</body>

</html>
